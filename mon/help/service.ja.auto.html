<header>サービス定義に関するMONヘルプ</header><p>これは、MON構成の2番目および最後の段階です。 <p>必須サービスのデフォルト値が表示されます<marked in RED color> 。サービス定義の詳細については、以下のそれぞれのヘルプトピックを参照してください。 <p> <b>「mail.alert」の</b>場合は、sendmailが構成され、 <b>「sendmail」</b>デーモンがホストマシンで開始されていることを確認してください。 <H3>サービス定義</H3><P><DL COMPACT><DT> <B>サービス</b> <I>servicename</i> <DD>サービス定義は、キーワード<B>serviceで</b>始まり、このサービスのタグである単語が続きます。 <P>サービスのコンポーネントは、以下に定義するように、間隔、モニター、および1つ以上の期間定義です。 <P> 「デフォルト」のサービス名が「dafault」と呼ばれる監視グループ内で定義されている場合（上記を参照）、デフォルト/デフォルトの定義が不明なmonトラップの処理に使用されます。 <P><DT> <B>間隔</b> <I>体timeval</i> <DD>キーワードの<B>間隔と</b>それに続く時間の値は、監視スクリプトがトリガーされる頻度を指定します。時間の値は、「30秒」、「5分」、「1時間」、または「1日」として定義され、30秒、5分、1時間、または1日を意味します。数値部分は、「1.5h」または1時間半などの端数である場合があります。時間指定のこの形式は、 <I>timeval</i>と呼ばれ<I>ます</i> 。 <P><DT> <B>traptimeout</b> <I>timeval</i> <DD>このキーワードは、 <B>間隔</b>と同じ時間指定の引数を取り<I>、</i>そして多くの場合、他の障害が登録され、少なくとも外部からのトラップ期待するサービスになります。これは、ハートビートスタイルのサービスに使用されます。 <P><DT> <B>trapduration</b> <I>体timeval</i> <DD>トラップが受信された場合、トラップが配信されたサービスのステータスは通常一定のままです。 <B>trapduration</b>が指定されている場合、サービスのステータスは、 <I>timeval</i>で指定された期間、失敗状態のままになり、その後、「成功」にリセットされます。 <P><DT> <B>randskew</b> <I>timeval</i> <DD>監視スクリプトを各間隔の開始時に実行するようにスケジュールするのではなく、プラスまたはマイナスの<B>ランドスキュー</b>によって、 <B>間隔</b>パラメーターで指定された<B>間隔を</b>ランダムに調整します<B>。</b> skewの値は、 <B>interval</b>パラメータとして指定されます： &quot;30s&quot;、 &quot;5m&quot;など...たとえば、 <B>interval</b>が1mで、 <B>randskew</b>が &quot;5s&quot;の場合、 <I>mon</i>は55秒ごとに監視スクリプトをスケジュールします。 65秒。その目的は、多くのサービスが同じ間隔でスケジュールされている場合に、サーバーの負荷を分散することです。 <P><DT> <B>モニター</b> <I>モニター名[引数...]</i> <DD>キーワード<B>monitorの</b>後にスクリプト名と引数が続き、タイマーが切れたときに実行するモニターを指定します。監視スクリプトに送信する引数を指定するときは、シェルのような引用規則に従います。スクリプトは、 <B>-s</b>引数で指定されたディレクトリから呼び出され、後続のすべての単語は、監視プログラムへの引数として提供され、その後に現在の監視グループが参照するグループ内のホストのリストが続きます。モニター行が「;;」で終わる場合別の言葉として、ホストグループは、プログラムが呼び出されたときに引数リストに追加されません。 <P><DT> <B>allow_empty_group</b> <DD> <B>allow_empty_group</b>オプションを使用すると、無効なホストのためにその監視のホストグループが空の場合でも、モニターを呼び出すことができます。ホストグループ内のすべてのホストが無効になっている場合、デフォルトの動作ではモニターは呼び出されません。 <P><DT> <B>説明</b> <I>descriptiontext</i> <DD> <B>説明に</b>続くテキストは、クライアントプログラムによって照会され、環境変数を介してアラートとモニターに渡されます。電子メールまたはWebページに含めるのに適した、サービスの簡単な説明を含める必要があります。 <P><DT> <B>exclude_hosts</b> <I>host [host ...]</i> <DD> <B>exclude_hostsの</b>後にリストされているすべてのホストは、サービスチェックから除外されます。 <P><DT> <B>exclude_period</b> <I>periodspec</i> <DD> <I>periodspecで</i>指定された時間中は、スケジュールされたモニターを実行しないでください。 <P><DT> <I>dependexpressionに</i> <B>依存</b> <DD> <B>depend</b>キーワードは、ブール式でtrueまたはfalseのいずれかに評価される依存関係式を指定するために使用されます。依存関係は実際のPerl式であり、すべての構文規則に従う必要があります。式は独自のパッケージスペースで評価され、予期しない副作用が誤って発生しないようになっています。式の評価中に構文エラーが見つかった場合、syslogを介してログに記録されます。 <P>評価の前に、式で次の置換が行われます。「group：service」のように見えるフレーズは、その指定されたサービスの現在の動作ステータスの値で置換されます。これらのopstatus置換は再帰的に計算されるため、サービスAがサービスBに依存し、サービスBがサービスCに依存している場合、サービスAはサービスCに依存します。 &quot;、&quot; STAT_WARMSTART &quot;、および&quot; STAT_UNKNOWN &quot;。単語「SELF」（すべて大文字）は、グループ（たとえば、「SELF：service」）に使用でき、現在の監視グループの省略形です。 <P>この機能を使用して、他のサービスに依存しているサービスのアラートを制御できます。たとえば、pingで到達可能なマシンに依存しているSMTPテストなどです。 <P><DT> <B>dep_behavior</b> <I>{a | m}</i> <DD>依存関係グラフの評価により、アラートまたはモニター呼び出しの抑制を制御できます。 <P> <B>アラート抑制</b> 。このオプションが「a」に設定されている場合、依存関係式は、サービスのモニターの終了後、またはトラップの受信後に評価されます。アラートは、評価が成功した場合にのみ送信されます。つまり、ディペンデンシーグラフのどのノードも失敗を示していません。 <P> <B>抑制を監視し</b>ます。 「m」に設定すると、サービスのモニターが実行される前に依存関係式が評価されます。評価が成功すると、モニターが実行されます。そうしないと、モニターは実行されず、サービスのステータスは同じままになります。 <P></DL><A NAME="lbAO">&nbsp;</A><H3>期間の定義</H3><P>期間は、アラートの配信を許可する条件を定義するために使用されます。 <P><DL COMPACT><DT> <B>期間</b> <I>[ラベル：] periodspec</i> <DD>ピリオドは、障害が発生したときにアラートが発生する頻度を制御する1つ以上のアラームと変数をグループ化します。 <B>period</b>キーワードには2つの形式があります。 1つ目は、Patrick RyanのTime :: Period Perl 5モジュールからの期間指定である引数を取ります。詳細については、「perldoc Time :: Period」を参照してください。 <P> 2番目の形式では、上で定義したように、ラベルの後にピリオド指定が必要です。ラベルは、アルファベット文字またはアンダースコアの後に0個以上の英数字またはアンダースコアが続き、コロンで終わるタグです。このフォームは、同じ期間定義を持つ複数の期間を許可します。 1つの用途は、これらのパラメータを含まないアラートの異なるセットと同じ期間には<B>alertafter</b>または特定の期間の<B>alertevery</b>パラメータ、および別のものを持っていない期間の定義を持つことです。 <P><DT> <B>alertevery</b> <I>体timeval</i> <DD> （ <B>期間</b>定義内の） <B>alertevery</b>キーワードは、 <B>間隔</b>変数と同じタイプの引数を取り、サービスが引き続き失敗するときにアラートが送信される回数を制限します。たとえば、間隔が「1h」の場合、期間セクションのアラートのみが1時間に1回だけトリガーされます。期間のエントリで<B>alertevery</b>キーワードを省略した場合、障害が検出されるたびにアラートが送信されます。デフォルトでは、2つの連続した失敗の出力が変化すると、アラート間隔が上書きされます。 「summary」という語が最後の引数である場合、連続する失敗の出力を比較するときに、要約出力行のみが考慮されます。 <P><DT> <B>Alertafter</b> <I>num</i> <DD><P><DT> <B>alertafter</b> <I>num timeval</i> <DD> （ <B>ピリオド</b>セクション内の） <B>alertafter</b>キーワードには2つの形式があります。「num」引数のみ、または「num timeval」引数のみです。最初の形式では、アラートは「num」回連続して失敗した後にのみ呼び出されます。 <P> 2番目の形式では、引数は、上記の<B>間隔</b>変数で説明されて<B>いる</b>ように、間隔が続く正の整数です。これらのパラメーターが指定されている場合、その期間のアラートは、その間隔内で多くの障害が発生した後にのみ呼び出されます。たとえば、 <B>alertafterに</b>引数「3 30m」を指定した場合、30分以内に3つの失敗が発生するとアラートが呼び出されます。 <P><DT> <B>numalerts</b> <I>num</i> <DD><P>この変数は、障害発生時に<I>num個以下の</i>アラートを呼び出すようサーバーに指示します。アラートカウンターは期間ごとに保持され、成功するたびにリセットされます。 <P><DT> <B>comp_alerts</b> <DD><P>このオプションを指定すると、対応する「ダウン」アラートが呼び出された場合にのみ、アップアラートが呼び出されます。 <P><DT> <B>アラート</b> <I>アラート[引数...]</i> <DD>期間には、サービスの失敗時にトリガーされる複数のアラートが含まれる場合があります。アラートは、 <B>alert</b>キーワードで指定され、その後にオプションの<B>出口</b>パラメーター、および<B>モニター</b>定義と同じように解釈される引数が続きますが、「;;」がありません。例外。 <B>exit</b>パラメータは、 <B>exit = x</b>または<B>exit = xy</b>の形式を取り、監視スクリプトの終了ステータスが<B>exit</b>パラメータの範囲内にある場合にのみアラートが呼び出されるという効果があります。たとえば、アラート行が<I>alert exit = 10-20 mail.alert misの</i>場合、モニタープログラムの終了値が<I>10〜20の場合</i>にのみ、 <I>mail-alert</i>が引数として<I>mis</i>で呼び出されます。この機能により、さまざまな重大度レベルのさまざまなアラート（空きディスク領域が8％から3％に変化する場合など）。 <P>月がアラートプログラムに自動的に渡されますpramaetersのリストについては、上記<B>ALERTプログラムの</b>セクションを参照してください。 <P><DT> <B>upalert</b> <I>アラート[arg ...]</i> <DD> <B>アップ</b> <B>アラート</b>は<B>アラート</b>の賛辞です。アップアラートは、サービスが状態を失敗から成功に移行させるときに呼び出されます。 <B>upalertスクリプト</b>は、単にそれがupalertと呼ばれていることを警告スクリプトを知ることができるように使用されている<B>-u</b>パラメータを追加して、 <B>アラートのスクリプト</b>と同じパラメータを指定すると呼ばれています。各期間定義に複数のアップアラートを指定できます。状態遷移時にアップアラートがトリガーされるため、デフォルトの動作では、送信された「ダウン」アラートがあったかどうかに関係なく、アップアラートが送信されます。期間<B>ごとのcomp_alerts</b>オプションを設定して、 <B>アップ</b>アラートと「ダウン」アラートをペアにします。 <P><DT> <B>startupalert</b> <I>アラート[引数...]</i> <DD> <B>startupalert</b>は、 <B>mon</b>サーバーが実行を開始したときにのみ呼び出されます。 <P><DT> <B>upvalertafter</b> <I>timeval</i> <DD> <B>upalertafter</b>パラメータは、 <B>interval</b>パラメータの構文（ &quot;30s&quot;、 &quot;1m&quot;など）に続く文字列として指定され、 <B>upalertの</b>トリガーを制御します。このオプションの値以上の時間停止した後にサービスが<B>復旧</b>すると、 <B>アップアラート</b>が呼び出されます。このオプションを使用して、「ブリップ」（一時的な停止）のためにアップアラートが呼び出されるのを防ぎます。 <P>