<header> Довідка MON щодо визначення послуг </header><p> Це другий і останній етап конфігурації MON. <p> Значення за замовчуванням відображаються для обов&#39;язкових служб <marked in RED color> . Дивіться відповідну тему довідки нижче, щоб отримати додаткову допомогу щодо Визначень послуг. <p> Для <b>&quot;mail.alert&quot;</b> переконайтесь, що sendmail налаштовано, а <b>&quot;sendmail&quot;</b> deamon запускається на хост-машині. <H3> Визначення послуг </H3><P><DL COMPACT><DT> <I>ім&#39;я</i> <B>послуги</b> <DD> Визначення послуги починається з <B>служби</b> ключових слів, а потім із слова, яке є тегом для цієї послуги. <P> Компоненти послуги - це інтервал, монітор та одне або більше визначень часового періоду, як визначено нижче. <P> Якщо назва служби &quot;за замовчуванням&quot; визначена в групі спостереження під назвою &quot;dafault&quot; (див. Вище), то визначення за замовчуванням / за замовчуванням буде використовуватися для обробки невідомих мон-пасток. <P><DT> <B>інтервал</b> <I>часу</i> <DD> <B>Інтервал</b> ключових слів, який супроводжується значенням часу, визначає частоту запуску сценарію монітора. Значення часу визначаються як &quot;30s&quot;, &quot;5m&quot;, &quot;1h&quot; або &quot;1d&quot;, що означає 30 секунд, 5 хвилин, 1 годину або 1 день. Числова частина може бути дробом, наприклад, «1,5 год» або півтори години. Цей формат часової специфікації буде називатися <I>часовим інтервалом</i> . <P><DT> <B>traptimeout</b> <I>timeval</i> <DD> Це ключове слово приймає той самий аргумент специфікації <B>часу</b> <I>,</i> як <B>інтервал</b> <I>,</i> і змушує службу очікувати пастки від зовнішнього джерела хоча б часто, інакше помилка буде зареєстрована. Це використовується для сердечного обслуговування. <P><DT> <B>таймвал</b> <I>трапдурації</i> <DD> Якщо пастка отримана, стан послуги, до якої було доставлено пастку, як правило, залишається незмінним. Якщо <B>вказана трапдурація</b> , статус послуги залишатиметься в стані відмови протягом тривалості, визначеної <I>тимчасовим інтервалом</i> , а потім буде скинутий на &quot;успіх&quot;. <P><DT> <B>randskew</b> <I>timeval</i> <DD> Замість того, щоб запланувати сценарій монітора для запуску на початку кожного інтервалу, випадковим чином відрегулюйте інтервал, визначений параметром <B>інтервалу,</b> через плюс-або-мінус <B>randskew.</b> Значення перекосу вказується як параметр <B>інтервалу</b> : &quot;30s&quot;, &quot;5m&quot; тощо. Наприклад, якщо <B>інтервал</b> дорівнює 1 м, а <B>рейдшвек</b> - &quot;5с&quot;, <I>пн</i> буде планувати сценарій монітора деякий час між кожні 55 секунд і 65 секунд. Наміром є допомогти розподілити навантаження на сервер, коли багато сервісів заплановано з однаковими інтервалами. <P><DT> <B>монітор</b> <I>-ім&#39;я монітора [арг ...]</i> <DD> <B>Монітор</b> ключових слів з ім&#39;ям сценарію та аргументами визначає запуск монітора, коли таймер закінчується. Обов&#39;язки цитування, подібні до оболонок, дотримуються, коли вказуються аргументи для надсилання до сценарію монітора. Сценарій викликається в каталозі, заданому аргументом <B>-s</b> , і всі наступні слова подаються як аргументи до програми монітора, а потім перелік хостів у групі, на яку посилається поточна група спостереження. Якщо рядок монітора закінчується символом &quot;;;&quot; як окреме слово, хост-групи не додаються до списку аргументів, коли програма викликається. <P><DT> <B>enable_empty_group</b> <DD> Параметр <B>enable_empty_group</b> дозволить викликати монітор навіть тоді, коли група хостів для цього годинника порожня через відсутність хостів. Типова поведінка - це не викликати монітор, коли всі хости в групі хостів були відключені. <P><DT> <B>опис</b> <I>описутексту</i> <DD> Наступний <B>опис</b> тексту запитується клієнтськими програмами, передається сповіщенням та моніторам через змінну середовища. Він повинен містити короткий опис послуги, придатний для включення в електронний лист або на веб-сторінку. <P><DT> <B>виключити_хости</b> <I>хоста [хост ...]</i> <DD> Будь-які хости, перелічені після <B>виключення_хостів,</b> будуть виключені з перевірки обслуговування. <P><DT> <B>виключити_період</b> <I>періодупек</i> <DD> Не запускайте плановий монітор протягом часу, визначеного <I>періодами</i> . <P><DT> <B>залежно від</b> <I>вираження</i> <DD> Ключове слово <B>залежність</b> використовується для визначення виразу залежності, яке оцінюється як істинне хибне, в булевому значенні. Залежності - це фактичні вирази Perl, і вони повинні підкорятися всім синтаксичним правилам. Вирази оцінюються у власному просторі пакунків, щоб випадково не виникнути небажаних побічних ефектів. Якщо при оцінці виразу виявлена синтаксична помилка, вона реєструється через syslog. <P> Перед оцінкою в виразі відбуваються такі підстановки: фрази, які мають вигляд &quot;група: служба&quot;, замінюються значенням поточного операційного стану зазначеної послуги. Ці заміни opstatus обчислюються рекурсивно, тому якщо служба A залежить від послуги B, а служба B залежить від служби C, то служба A залежить від служби C. Успішні робочі статуси (які оцінюються як &quot;1&quot;) &quot;STAT_OK&quot;, &quot;STAT_COLDSTART &quot;,&quot; STAT_WARMSTART &quot;та&quot; STAT_UNKNOWN &quot;. Слово &quot;SELF&quot; (у всіх шапках) може бути використане для групи (наприклад, &quot;SELF: service&quot;) і є абревіатурою для поточної групи Watch. <P> Ця функція може використовуватися для керування сповіщеннями для служб, які залежать від інших служб, наприклад, тест SMTP, який залежить від того, на якій машині буде доступно пінг. <P><DT> <B>dep_behavior</b> <I>{a | m}</i> <DD> Оцінка графіків залежності може контролювати придушення або тривожних викликів, або спостереження. <P> <B>Придушення сповіщення</b> Якщо для цього параметра встановлено значення &quot;a&quot;, вираз залежності буде оцінено після виходу монітора для служби або після отримання пастки. Попередження буде надіслане лише у випадку успішної оцінки, що означає, що жоден з вузлів у графіку залежності не вказує на збій. <P> <B>Контроль придушення</b> . Якщо воно встановлено на &quot;m&quot;, то вираз залежності буде евальовано до того, як монітор для служби збирається запустити. Якщо еваляція пройде успішно, монітор буде запущений. В іншому випадку монітор не буде запускатися, і стан служби залишиться колишнім. <P></DL><A NAME="lbAO">&nbsp;</A><H3> Визначення періоду </H3><P> Періоди використовуються для визначення умов, які повинні дозволяти надсилати сповіщення. <P><DL COMPACT><DT> <B>period</b> <I>[label:] periodpec</i> <DD> Період групує один або кілька сигналів тривоги та змінних, які контролюють, як часто відбувається оповіщення, коли відбувається збій. Ключове слово <B>періоду</b> має дві форми. Перший бере аргумент, який є специфікацією періоду з модуля Патріка Райана Час :: Період Perl 5. Для отримання додаткової інформації див. &quot;Час perldoc :: Період&quot;. <P> Друга форма вимагає етикетки з наступною специфікацією періоду, як визначено вище. Мітка - це тег, що складається з алфавітного символу або підкреслення, з подальшим нулем або більше буквено-цифрових знаків або підкреслення і закінчується двокрапкою. Ця форма допускає декілька періодів з однаковим визначенням періоду. Одне використання - це визначення періоду, в якому немає параметрів <B>сповіщення</b> або <B>сповіщення про сповіщення</b> протягом певного періоду часу, а інше для того ж періоду часу з іншим набором сповіщень, яке містить ці параметри. <P><DT> <B>тривалість</b> <I>сповіщення</i> <DD> <B>Ключове</b> слово <B>попередження</b> (у визначенні <B>періоду</b> ) приймає аргумент того ж типу, що і <B>інтервальна</b> змінна, і обмежує кількість надсилань попередження, коли служба продовжує відмовлятися. Наприклад, якщо інтервал &quot;1h&quot;, то лише попередження в розділі періоду будуть спрацьовувати лише раз на годину. Якщо ключове слово <B>оповіщення</b> пропущено у записі періоду, повідомлення буде надсилатися щоразу, коли виявляється помилка. За замовчуванням, якщо вихід двох послідовних відмов змінюється, то інтервал оповіщення перевизначається. Якщо слово &quot;підсумок&quot; є останнім аргументом, то при порівнянні результатів послідовних відмов враховуватимуться лише підсумкові рядки виводу. <P><DT> <B>alertafter</b> <I>Num</i> <DD><P><DT> <B>попереджувальний номер</b> <I>timevalval</i> <DD> <B>Ключове</b> слово <B>попередження</b> (у розділі <B>періоду</b> ) має дві форми: лише з аргументом &quot;num&quot; або з аргументами &quot;num timeval&quot;. У першій формі сповіщення буде викликано лише після послідовних відмов &quot;нумерувати&quot;. <P> У другій формі аргументи - це додатне ціле число з подальшим інтервалом, як описано вище змінною <B>інтервалу</b> . Якщо вказані ці параметри, то сповіщення за цей період буде викликано лише після того, як протягом цього інтервалу станеться багато відмов. Наприклад, якщо <B>сповіщувачу</b> надано аргументи &quot;3 30м&quot;, то сповіщення буде викликано, якщо протягом 30 хвилин трапиться 3 відмови. <P><DT> <B>numalerts</b> <I>num</i> <DD><P> Ця змінна вказує сервера не більше попереджень <I>піт</i> виклику під час збою. Лічильник сповіщень зберігається періодично та скидається під час кожного успіху. <P><DT> <B>comp_alerts</b> <DD><P> Якщо вказана ця опція, виклику upalerts буде викликано лише в тому випадку, якщо було викликано відповідне сповіщення &quot;вниз&quot;. <P><DT> <B>попередження</b> <I>[аргумент ...]</i> <DD> Період може містити кілька сповіщень, які спрацьовують після відмови служби. Попередження задається ключовим словом <B>попередження</b> , за ним - необов&#39;язковий параметр <B>виходу</b> та аргументи, які інтерпретуються так само, як визначення <B>монітора</b> , але без &quot;;&quot; виняток. Параметр <B>виходу</b> має вигляд <B>exit = x</b> або <B>exit = xy</b> і <B>призводить</b> до того, що сповіщення викликається лише у тому випадку, якщо статус виходу скрипта монітора потрапляє в діапазон параметра <B>виходу</b> . Наприклад, якщо рядок оповіщення є <I>вихідним сповіщенням = 10-20 mail.alert mis,</i> тоді <I>поштове сповіщення</i> буде викликано <I>помилково</i> як його аргументи, якщо значення виходу програми монітора становить від 10 до 20. Ця функція дозволяє запускати різні сповіщення різного рівня вираженості (наприклад, коли вільний простір на диску становить від 8% до 3%). <P> Див. Розділ <B>ПРОГРАМИ ALERT</b> вище, список списку праметерів автоматично передається для програм попередження. <P><DT> <I>сповіщення про</i> <B>upalert</b> <I>[</i> <B>арг</b> <I>...]</i> <DD> <B>Упалерт</b> - комплімент <B>попередження</b> . Упалерт називається, коли сервіс робить стан переходу від невдачі до успіху. Сценарій <B>upalert</b> називається тим, що надає ті самі параметри, що і сценарій <B>оповіщення</b> , з додаванням параметра <B>-u,</b> який просто використовується для того, щоб скрипт попередження знав, що він викликається як upalert. Для кожного визначення періоду може бути вказано декілька параметрів. Зверніть увагу, що поведінка за замовчуванням полягає в тому, що упалерта буде надіслана незалежно від того, чи були надіслані попередні сповіщення про &quot;вниз&quot;, оскільки пакети запускаються при переході стану. Встановіть параметр <B>comp_alerts</b> за періодом, щоб з’єднати upalerts з попередженнями &quot;вниз&quot; <P><DT> <I>попередження про</i> <B>startupalert</b> <I>[</i> <B>арг</b> <I>...]</i> <DD> <B>Startupalert</b> викликається тільки тоді , коли сервер <B>ПН</b> починає виконання. <P><DT> <B>upalertafter</b> <I>timeval</i> <DD> Параметр <B>upalertafter</b> визначається у вигляді рядка, який слід за синтаксисом параметра <B>інтервалу</b> (&quot;30s&quot;, &quot;1m&quot; тощо) та керує спрацюванням запуску <B>upalert</b> . Якщо послуга повертається назад після виходу з ладу на час, більший або рівний значенню цієї опції, буде викликано <B>upalert</b> . Використовуйте цю опцію, щоб запобігти виклику упалера через &quot;провалля&quot; (короткий відключення). <P>