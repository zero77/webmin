<header> Pomoc MON dotycząca definicji usług </header><p> To drugi i ostatni etap konfiguracji MON. <p> Wartości domyślne są wyświetlane dla usług obowiązkowych <marked in RED color> . Więcej informacji na temat definicji usług znajduje się w odpowiednim temacie pomocy poniżej. <p> W przypadku <b>„mail.alert”</b> upewnij się, że sendmail jest skonfigurowany i że deamon <b>„sendmail”</b> jest uruchomiony na maszynie hosta. <H3> Definicje usług </H3><P><DL COMPACT><DT> <I>nazwa</i> <B>usługi</b> <DD> Definicja usługi zaczyna się od słowa kluczowego <B>service,</b> po którym następuje słowo będące znacznikiem tej usługi. <P> Składnikami usługi są interwał, monitor oraz jedna lub więcej definicji przedziałów czasowych, jak zdefiniowano poniżej. <P> Jeśli nazwa usługi „default” jest zdefiniowana w grupie obserwacyjnej o nazwie „dafault” (patrz wyżej), wówczas do obsługi nieznanych pułapek mon zostanie użyta definicja default / default. <P><DT> <B>interwał</b> <I>czasowy</i> <DD> <B>Interwał</b> słowa kluczowego, po którym następuje wartość czasu, określa częstotliwość uruchamiania skryptu monitorowania. Wartości czasu są zdefiniowane jako „30s”, „5m”, „1h” lub „1d”, co oznacza 30 sekund, 5 minut, 1 godzinę lub 1 dzień. Część liczbowa może być ułamkiem, takim jak „1,5 godziny” lub półtorej godziny. Ten format specyfikacji czasu będzie określany jako <I>czasowy</i> . <P><DT> <B>traptimeout</b> <I>timeval</i> <DD> Ten parametr bierze jednocześnie specyfikacji argument jako <B><I>przedział,</i></b> i sprawia, że obsługa spodziewać się pułapki z zewnętrznego źródła przynajmniej tak często, jeszcze awaria zostanie zarejestrowany. Jest to używane w przypadku usługi w stylu pulsu. <P><DT> <B>trapduration</b> <I>timeval</i> <DD> Jeśli zostanie odebrana pułapka, status usługi, do której została dostarczona pułapka, zwykle pozostaje stały. Jeśli <B>trapduration</b> jest określony status usługi pozostaną w stanie awarii na czas określony przez <I>timeval,</i> a następnie będzie zresetowane do „sukcesu”. <P><DT> <B>randskew</b> <I>timeval</i> <DD> Zamiast zaplanować uruchamianie skryptu monitorowania na początku każdego interwału, losowo dostosuj interwał określony parametrem <B>interwału za</b> pomocą <B>randskew</b> plus-lub-minus <B>.</b> Wartość pochylenia jest określona jako parametr <B>interwału</b> : „30s”, „5m” itp. Na przykład, jeśli <B>interwał</b> wynosi 1 m, a <B>randskew</b> wynosi „5s”, wówczas <I>mon</i> zaplanuje skrypt monitorowania co jakiś czas między 55 sekundami a 65 sekund. Ma to na celu pomóc w rozłożeniu obciążenia na serwer, gdy wiele usług jest zaplanowanych w tych samych odstępach czasu. <P><DT> <B>monitor</b> <I>nazwa-monitora [arg ...]</i> <DD> Słowo kluczowe <B>monitor,</b> po którym następuje nazwa skryptu i argumenty określają, że monitor ma działać po upływie czasu. Podczas określania argumentów wysyłanych do skryptu monitorowania przestrzegane są podobne do powłoki konwencje cytowania. Skrypt jest wywoływany z katalogu podanego z argumentem <B>-s</b> , a wszystkie poniższe słowa są dostarczane jako argumenty do programu monitorującego, a następnie lista hostów w grupie, do której odnosi się bieżąca grupa obserwacyjna. Jeśli linia monitora kończy się na „;;” jako osobne słowo grupy hostów nie są dołączane do listy argumentów podczas wywoływania programu. <P><DT> <B>allow_empty_group</b> <DD> Opcja <B>allow_empty_group</b> pozwoli na wywołanie monitora, nawet gdy grupa hostów dla tego zegarka jest pusta z powodu wyłączonych hostów. Domyślnym zachowaniem nie jest wywoływanie monitora, gdy wszystkie hosty w grupie hostów zostały wyłączone. <P><DT> <B>opis</b> <I>opistekst</i> <DD> Tekst poniższy <B>opis</b> jest pytani przez programy klienckie, przekazanych do ostrzeżeń i monitorów poprzez zmienną środowiskową. Powinien zawierać krótki opis usługi, odpowiedni do zamieszczenia w wiadomości e-mail lub na stronie internetowej. <P><DT> <B>exclude_hosts</b> <I>host [host ...]</i> <DD> Wszelkie hosty wymienione po <B>exclude_hosts</b> zostaną wykluczone z kontroli usługi. <P><DT> <B>exclude_period</b> <I>periodspec</i> <DD> Nie uruchamiaj zaplanowanego monitora w czasie określonym przez <I>okres</i> . <P><DT> <B>zależy zależne</b> <I>wyrażenie</i> <DD> <B>Słowo</b> kluczowe <B>depend</b> służy do określania wyrażenia zależności, które ma wartość prawda lub fałsz, w sensie logicznym. Zależności są rzeczywistymi wyrażeniami Perla i muszą być zgodne ze wszystkimi regułami składniowymi. Wyrażenia są oceniane we własnej przestrzeni pakietów, aby przypadkowo nie wywołać niepożądanych skutków ubocznych. Jeśli podczas oceny wyrażenia zostanie znaleziony błąd składniowy, jest on rejestrowany przez syslog. <P> Przed oceną występują następujące podstawienia wyrażenia: frazy, które wyglądają jak „grupa: usługa” są zastępowane wartością bieżącego statusu operacyjnego tej określonej usługi. Te podstawienia opstatus są obliczane rekurencyjnie, więc jeśli usługa A zależy od usługi B, a usługa B zależy od usługi C, to usługa A zależy od usługi C, a pomyślne statusy operacyjne (które mają wartość „1”) to „STAT_OK”, „STAT_COLDSTART ”,„ STAT_WARMSTART ”i„ STAT_UNKNOWN ”. Słowo „SELF” (wielkimi literami) może być użyte dla grupy (np. „SELF: service”) i jest skrótem dla bieżącej grupy obserwacyjnej. <P> Ta funkcja może być używana do kontrolowania alertów dla usług zależnych od innych usług, np. Testu SMTP, który zależy od tego, czy komputer jest osiągalny przez ping. <P><DT> <B>dep_behavior</b> <I>{a | m}</i> <DD> Ocena wykresów zależności może kontrolować tłumienie wywołań alertów lub monitorowania. <P> <B>Eliminacja alertów</b> . Jeśli ta opcja jest ustawiona na „a”, wyrażenie zależności zostanie ocenione po wyjściu monitora z usługi lub odebraniu pułapki. Alert zostanie wysłany tylko wtedy, gdy ocena się powiedzie, co oznacza, że żaden z węzłów na wykresie zależności nie wskazuje niepowodzenia. <P> <B>Monitoruj tłumienie</b> . Jeśli jest ustawiona na „m”, wyrażenie zależności zostanie ewaluowane przed uruchomieniem monitora usługi. Jeśli ewaluacja się powiedzie, monitor zostanie uruchomiony. W przeciwnym razie monitor nie zostanie uruchomiony, a status usługi pozostanie taki sam. <P></DL><A NAME="lbAO">&nbsp;</A><H3> Definicje okresu </H3><P> Okresy służą do określania warunków, które powinny umożliwić wysyłanie ostrzeżeń. <P><DL COMPACT><DT> <B>okres</b> <I>[etykieta:] okresspec</i> <DD> Okres grupuje jeden lub więcej alarmów i zmiennych, które kontrolują, jak często zdarza się alert w przypadku awarii. <B>Słowo</b> kluczowe <B>okresu</b> ma dwie formy. Pierwszy bierze argument, który jest specyfikacją okresu z modułu Patrick Ryan&#39;s Time :: Period Perl 5. Aby uzyskać więcej informacji, patrz „czas perldoc :: okres”. <P> Drugi formularz wymaga etykiety, a następnie specyfikacji okresu, jak zdefiniowano powyżej. Etykieta to etykieta składająca się ze znaku alfabetu lub znaku podkreślenia, po którym następuje zero lub więcej znaków alfanumerycznych lub znaków podkreślenia i kończy się dwukropkiem. Ten formularz pozwala na wiele okresów z tą samą definicją okresu. Jednym z zastosowań jest zdefiniowanie okresu, który nie ma żadnych parametrów <B>alarmowych</b> lub <B>alarmowych</b> dla określonego okresu, a drugi dla tego samego okresu z innym zestawem alertów, który zawiera te parametry. <P><DT> <B>alertevery</b> <I>timeval</i> <DD> <B>Słowo</b> kluczowe <B>alertevery</b> (w ramach definicji <B>okresu</b> ) przyjmuje ten sam typ argumentu, co zmienna <B>interwałowa</b> , i ogranicza liczbę wysyłanych alertów, gdy usługa nadal nie działa. Na przykład, jeśli interwał wynosi „1h”, to tylko alarmy w sekcji okresu będą uruchamiane tylko raz na godzinę. Jeśli słowo kluczowe <B>alert</b> zostanie pominięte we wpisie okresu, alert zostanie wysłany za każdym razem, gdy zostanie wykryta awaria. Domyślnie, jeśli wynik dwóch kolejnych awarii ulegnie zmianie, wówczas odstęp czasu alertu zostanie zastąpiony. Jeśli słowo „podsumowanie” jest ostatnim argumentem, to przy porównywaniu wyników kolejnych awarii brane będą pod uwagę tylko podsumowujące linie wyjściowe. <P><DT> <B>alertafter</b> <I>num</i> <DD><P><DT> <B>alertafter</b> <I>num timeval</i> <DD> Słowo kluczowe <B>alertafter</b> (w sekcji <B>okres)</b> ma dwie formy: tylko z „num” argumentu, albo z „num timeval” argumentów. W pierwszej formie alert będzie wywoływany tylko po „num” kolejnych awarii. <P> W drugiej postaci argumenty są dodatnimi liczbami całkowitymi, po których następuje interwał, jak opisano powyżej w zmiennej <B>interwałowej</b> . Jeśli te parametry są określone, alerty dla tego okresu będą wywoływane dopiero po tym, jak wiele awarii wystąpi w tym okresie. Na przykład, jeśli <B>alertafter</b> otrzyma argument „3 30 m”, wówczas alarm zostanie wywołany, jeśli 3 awarie wystąpią w ciągu 30 minut. <P><DT> <B>numalerts</b> <I>num</i> <DD><P> Ta zmienna informuje serwer, aby w przypadku awarii wywoływał nie więcej niż <I>num</i> alertów. Licznik alertów jest przechowywany dla poszczególnych okresów i jest resetowany po każdym sukcesie. <P><DT> <B>comp_alerts</b> <DD><P> Jeśli ta opcja jest podana, wówczas podwyższenia będą wywoływane tylko wtedy, gdy zostanie wywołany odpowiedni alert „przestoju”. <P><DT> <B>alert</b> <I>alert [arg ...]</i> <DD> Okres może zawierać wiele alertów, które są uruchamiane w przypadku awarii usługi. Alert jest określany za pomocą słowa kluczowego <B>alert</b> , po nim opcjonalny parmeter <B>wyjścia</b> i argumenty interpretowane tak samo jak definicja <B>monitora</b> , ale bez „;;” wyjątek. Parametr <B>wyjścia</b> ma postać <B>exit = x</b> lub <B>exit = xy</b> i powoduje, że alert jest wywoływany tylko wtedy, gdy status wyjścia skryptu monitorowania mieści się w zakresie parametru <B>exit</b> . Jeśli, na przykład, linia alertu to <I>alert exit = 10-20</i> <I>mail. Alert</i> <I>mis,</i> wówczas <I>mail-alert</i> zostanie wywołany z argumentem <I>mis</i> jako argumentami, jeśli wartość wyjścia programu monitorującego wynosi od 10 do 20. Ta funkcja umożliwia wyzwolenie różne alerty o różnych poziomach ważności (np. gdy wolne miejsce na dysku zwiększa się z 8% do 3%). <P> Zobacz sekcję <B>PROGRAMY</b> ALERTOWE powyżej, aby wyświetlić listę osób, które mon przekażą automatycznie programy alarmowe. <P><DT> <B>upalert</b> <I>alert [arg ...]</i> <DD> <B>Upalert</b> jest uzupełnieniem <B>ostrzeżenia</b> . Upalert jest wywoływany, gdy usługa przechodzi stan od niepowodzenia do sukcesu. Skrypt <B>upalert</b> nazywa się podając te same parametry, co skrypt <B>alertu</b> , z dodatkiem parametru <B>-u</b> , który służy po prostu do poinformowania skryptu alertu, że jest wywoływany jako upalert. Dla każdej definicji okresu można określić wiele podwyższeń. Należy pamiętać, że domyślnym zachowaniem jest wysyłanie aktualizacji w górę, niezależnie od tego, czy wysłano jakiekolwiek wcześniejsze ostrzeżenia „w dół”, ponieważ zmiany w górę są wywoływane przy zmianie stanu. Ustaw opcję <B>comp_alerts na</b> okres, aby sparować upalerty z alertami „down”. <P><DT> <I>alert</i> <B>startalert</b> <I>[arg ...]</i> <DD> <B>Startalert</b> jest wywoływany tylko wtedy, gdy serwer <B>mon</b> rozpoczyna wykonywanie. <P><DT> <B>upalertafter</b> <I>timeval</i> <DD> Parametr <B>upalertafter</b> jest określony jako ciąg znaków zgodny ze składnią parametru <B>interwału</b> („30s”, „1m” itp.) I kontroluje wyzwalanie <B>upalertu</b> . Jeśli usługa wraca do poprzedniego stanu po tym, jak nie działa przez czas dłuższy lub równy wartości tej opcji, <B>wywoływany</b> jest <B>upalert</b> . Użyj tej opcji, aby zapobiec wywoływaniu upalertów z powodu „blipów” (krótkich przerw). <P>