<header> Trợ giúp MON về định nghĩa dịch vụ </header><p> Đây là giai đoạn thứ hai và cuối cùng cho cấu hình MON. <p> Giá trị mặc định được hiển thị cho các dịch vụ Bắt buộc <marked in RED color> . Xem chủ đề trợ giúp tương ứng bên dưới để được trợ giúp thêm về Định nghĩa dịch vụ. <p> Đối với <b>&quot;mail.alert&quot;</b> , đảm bảo rằng sendmail được cấu hình và deamon <b>&quot;sendmail&quot;</b> được bắt đầu trên hostmachine. <H3> Định nghĩa dịch vụ </H3><P><DL COMPACT><DT> <I>servicename</i> <B>dịch vụ</b> <DD> Một định nghĩa dịch vụ bắt đầu với họ <B>dịch vụ</b> từ khóa theo sau là một từ là thẻ cho dịch vụ này. <P> Các thành phần của dịch vụ là một khoảng thời gian, màn hình và một hoặc nhiều định nghĩa khoảng thời gian, như được định nghĩa dưới đây. <P> Nếu tên dịch vụ của &quot;mặc định&quot; được xác định trong nhóm đồng hồ có tên là &quot;dafault&quot; (xem bên trên), thì định nghĩa mặc định / mặc định sẽ được sử dụng để xử lý các bẫy mon không xác định. <P><DT> <B>khoảng</b> <I>timeval</i> <DD> <B>Khoảng thời gian</b> từ khóa theo sau là một giá trị thời gian xác định tần suất mà tập lệnh màn hình sẽ được kích hoạt. Giá trị thời gian được xác định là &quot;30 giây&quot;, &quot;5m&quot;, &quot;1h&quot; hoặc &quot;1d&quot;, nghĩa là 30 giây, 5 phút, 1 giờ hoặc 1 ngày. Phần số có thể là một phần nhỏ, chẳng hạn như &quot;1,5h&quot; hoặc một tiếng rưỡi. Định dạng này của một đặc tả thời gian sẽ được gọi là <I>timeval</i> . <P><DT> <B>traptimeout</b> <I>timeval</i> <DD> Từ khóa này có tham số đặc điểm kỹ thuật thời gian giống như <B>khoảng thời <I>gian,</i></b> và làm cho các dịch vụ mong đợi một cái bẫy từ một nguồn bên ngoài ít nhất đó thường xuyên, khác một thất bại sẽ được đăng ký. Điều này được sử dụng cho một dịch vụ nhịp tim. <P><DT> <B>trapduration</b> <I>timeval</i> <DD> Nếu một cái bẫy được nhận, trạng thái của dịch vụ mà cái bẫy được chuyển đến thường sẽ không đổi. Nếu <B>trapduration</b> được chỉ định, tình trạng của dịch vụ sẽ vẫn ở trong tình trạng thất bại trong suốt thời gian theo quy định của <I>timeval,</i> và sau đó nó sẽ được đặt lại &quot;thành công&quot;. <P><DT> <B>randskew</b> <I>timeval</i> <DD> Thay vì lên lịch cho tập lệnh màn hình chạy ở đầu mỗi khoảng thời gian, hãy điều chỉnh ngẫu nhiên khoảng thời gian được chỉ định bởi tham số <B>khoảng</b> bằng <B>randskew</b> cộng hoặc trừ <B>.</b> Giá trị nghiêng được chỉ định là tham số <B>khoảng</b> : &quot;30 giây&quot;, &quot;5m&quot;, v.v ... Ví dụ: nếu <B>khoảng cách</b> là 1m và <B>randskew</b> là &quot;5s&quot;, thì <I>mon</i> sẽ lên lịch cho kịch bản theo dõi một khoảng thời gian trong khoảng 55 giây và 65 giây. Mục đích là để giúp phân phối tải trên máy chủ khi nhiều dịch vụ được lên lịch trong cùng một khoảng thời gian. <P><DT> <B>tên màn hình giám</b> <I>sát [arg ...]</i> <DD> Trình <B>theo dõi</b> từ khóa <B>theo</b> sau là tên tập lệnh và đối số chỉ định màn hình sẽ chạy khi hết giờ. Các quy ước trích dẫn giống như Shell được tuân theo khi chỉ định các đối số sẽ gửi đến tập lệnh màn hình. Tập lệnh được gọi từ thư mục được cung cấp với đối số <B>-s</b> và tất cả các từ sau được cung cấp dưới dạng đối số cho chương trình giám sát, theo sau là danh sách các máy chủ trong nhóm được gọi bởi nhóm theo dõi hiện tại. Nếu dòng màn hình kết thúc bằng &quot;;;&quot; như một từ riêng biệt, các nhóm máy chủ không được thêm vào danh sách đối số khi chương trình được gọi. <P><DT> <B>allow_empty_group</b> <DD> Tùy chọn <B>allow_empty_group</b> sẽ cho phép một màn hình được gọi ngay cả khi nhóm máy chủ cho đồng hồ đó trống vì các máy chủ bị vô hiệu hóa. Hành vi mặc định là không gọi màn hình khi tất cả các máy chủ trong nhóm máy chủ đã bị tắt. <P><DT> <B>mô</b> <I>tả mô tả</i> <DD> Văn bản <B>mô tả</b> sau đây được truy vấn bởi các chương trình máy khách, được chuyển đến cảnh báo và giám sát thông qua một biến môi trường. Nó nên chứa một mô tả ngắn gọn về dịch vụ, phù hợp để đưa vào email hoặc trên một trang web. <P><DT> <I>máy chủ loại</i> <B>trừ_hosts</b> <I>[máy chủ ...]</i> <DD> Bất kỳ máy chủ nào được liệt kê sau <B>Elim_hosts</b> sẽ bị loại khỏi kiểm tra dịch vụ. <P><DT> <B>loại trừ</b> <I>khoảng thời gian</i> <DD> Không chạy một màn hình theo lịch trình trong thời gian được xác định bởi <I>periodspec</i> . <P><DT> <B>phụ thuộc</b> <I>dependexpression</i> <DD> Từ khóa <B>phụ thuộc</b> được sử dụng để xác định biểu thức phụ thuộc, đánh giá là đúng của sai, theo nghĩa boolean. Phụ thuộc là các biểu thức Perl thực tế và phải tuân theo tất cả các quy tắc cú pháp. Các biểu thức được đánh giá trong không gian gói riêng của chúng để không vô tình có một số tác dụng phụ không mong muốn. Nếu một lỗi cú pháp được tìm thấy khi đánh giá biểu thức, nó được ghi lại thông qua syslog. <P> Trước khi đánh giá, các thay thế sau đây trên biểu thức xảy ra: các cụm từ trông giống như &quot;nhóm: dịch vụ&quot; được thay thế bằng giá trị của trạng thái hoạt động hiện tại của dịch vụ được chỉ định đó. Các thay thế opstatus này được tính toán đệ quy, vì vậy nếu dịch vụ A phụ thuộc vào dịch vụ B và dịch vụ B phụ thuộc vào dịch vụ C, thì dịch vụ A phụ thuộc vào dịch vụ C. Các trạng thái hoạt động thành công (đánh giá là &quot;1&quot;) là &quot;STAT_OK&quot;, &quot;STAT_COLDSTART &quot;,&quot; STAT_WARMSTART &quot;và&quot; STAT_UNKNOWN &quot;. Từ &quot;TỰF&quot; (trong tất cả các chữ hoa) có thể được sử dụng cho nhóm (ví dụ: &quot;TỰF: dịch vụ&quot;) và là viết tắt của nhóm đồng hồ hiện tại. <P> Tính năng này có thể được sử dụng để kiểm soát các cảnh báo cho các dịch vụ phụ thuộc vào các dịch vụ khác, ví dụ: kiểm tra SMTP phụ thuộc vào máy có thể truy cập ping. <P><DT> <B>dep_behavior</b> <I>{a | m}</i> <DD> Việc đánh giá các biểu đồ phụ thuộc có thể kiểm soát việc loại bỏ các cảnh báo hoặc giám sát các lệnh. <P> <B>Cảnh báo đàn áp</b> . Nếu tùy chọn này được đặt thành &quot;a&quot;, thì biểu thức phụ thuộc sẽ được đánh giá sau khi màn hình cho dịch vụ thoát hoặc sau khi nhận được bẫy. Một cảnh báo sẽ chỉ được gửi nếu đánh giá thành công, có nghĩa là không có nút nào trong biểu đồ phụ thuộc chỉ ra lỗi. <P> <B>Giám sát đàn áp</b> . Nếu nó được đặt thành &quot;m&quot;, thì biểu thức phụ thuộc sẽ được loại bỏ trước khi màn hình cho dịch vụ sắp chạy. Nếu quá trình di chuyển thành công, thì màn hình sẽ được chạy. Nếu không, màn hình sẽ không được chạy và trạng thái của dịch vụ sẽ giữ nguyên. <P></DL><A NAME="lbAO">&nbsp;</A><H3> Định nghĩa thời gian </H3><P> Các khoảng thời gian được sử dụng để xác định các điều kiện sẽ cho phép cảnh báo được gửi. <P><DL COMPACT><DT> <B>Giai đoạn</b> <I>[label:] periodspec</i> <DD> Một giai đoạn nhóm một hoặc nhiều báo động và các biến kiểm soát mức độ thường xuyên xảy ra cảnh báo khi có lỗi. Từ khóa <B>kỳ</b> có hai hình thức. Đầu tiên lấy một đối số là một đặc tả thời gian từ mô-đun Time :: Time Perl 5 của Patrick Ryan. Tham khảo &quot;Thời gian perldoc :: Thời gian&quot; để biết thêm thông tin. <P> Hình thức thứ hai yêu cầu một nhãn theo sau là một đặc tả thời gian, như được định nghĩa ở trên. Nhãn là một thẻ bao gồm một ký tự chữ cái hoặc dấu gạch dưới theo sau bằng 0 hoặc nhiều chữ số hoặc dấu gạch dưới và kết thúc bằng dấu hai chấm. Hình thức này cho phép nhiều thời kỳ với cùng một định nghĩa thời gian. Một sử dụng là phải có một định nghĩa thời gian mà không có người <B>alertafter</b> hoặc <B>alertevery</b> tham số cho một khoảng thời gian đặc biệt, và một người khác trong khoảng thời gian tương tự với một bộ cảnh báo khác nhau mà có chứa những thông số. <P><DT> <B>alertevery</b> <I>timeval</i> <DD> Từ khóa <B>alertevery</b> (trong một định nghĩa <B>thời gian</b> ) có cùng loại đối số với biến <B>khoảng</b> và giới hạn số lần cảnh báo được gửi khi dịch vụ tiếp tục không thành công. Ví dụ: nếu khoảng thời gian là &quot;1h&quot;, thì chỉ các cảnh báo trong phần thời gian sẽ chỉ được kích hoạt một lần mỗi giờ. Nếu từ khóa <B>alertevery</b> bị bỏ qua trong một mục thời gian, một cảnh báo sẽ được gửi đi mỗi khi phát hiện ra lỗi. Theo mặc định, nếu đầu ra của hai lần thất bại liên tiếp thay đổi, thì khoảng thời gian cảnh báo sẽ bị ghi đè. Nếu từ &quot;tóm tắt&quot; là đối số cuối cùng, thì chỉ các dòng đầu ra tóm tắt sẽ được xem xét khi so sánh đầu ra của các thất bại liên tiếp. <P><DT> <B>cảnh báo sau</b> <I>num</i> <DD><P><DT> <B>cảnh báo sau</b> <I>num timeval</i> <DD> Từ khóa <B>alertafter</b> (trong một phần <B>thời gian</b> ) có hai dạng: chỉ với đối số &quot;num&quot; hoặc với đối số &quot;num timeval&quot;. Ở dạng đầu tiên, một cảnh báo sẽ chỉ được gọi sau khi &quot;num&quot; thất bại liên tiếp. <P> Ở dạng thứ hai, các đối số là một số nguyên dương theo sau là một khoảng, như được mô tả bởi biến <B>khoảng</b> ở trên. Nếu các tham số này được chỉ định, thì các cảnh báo trong khoảng thời gian đó sẽ chỉ được gọi sau khi có nhiều lỗi xảy ra trong khoảng đó. Ví dụ, nếu <B>alertafter</b> được đưa ra những lập luận &quot;3 30m&quot;, sau đó cảnh báo sẽ được gọi nếu 3 thất bại xảy ra trong vòng 30 phút. <P><DT> <B>chữ</b> <I>số</i> <DD><P> Biến này báo cho máy chủ gọi không quá <I>số</i> cảnh báo <I>num</i> trong một lỗi. Bộ đếm cảnh báo được giữ trên cơ sở theo từng giai đoạn và được đặt lại theo từng thành công. <P><DT> <B>comp_alerts</b> <DD><P> Nếu tùy chọn này được chỉ định, thì upalerts sẽ chỉ được gọi nếu cảnh báo &quot;xuống&quot; tương ứng đã được gọi. <P><DT> <B>cảnh báo cảnh</b> <I>báo [arg ...]</i> <DD> Một khoảng thời gian có thể chứa nhiều cảnh báo, được kích hoạt khi lỗi dịch vụ. Một cảnh báo được chỉ định với từ khóa <B>cảnh báo</b> , theo sau là một parmeter <B>thoát</b> tùy chọn và các đối số được diễn giải giống như định nghĩa của <B>màn hình</b> , nhưng không có &quot;;;&quot; ngoại lệ. Tham số <B>thoát</b> có dạng <B>exit = x</b> hoặc <B>exit = xy</b> và có tác dụng là cảnh báo chỉ được gọi nếu trạng thái thoát của tập lệnh màn hình nằm trong phạm vi của tham số <B>thoát</b> . Ví dụ: nếu dòng cảnh báo là <I>exit exit = 10-20 mail.alert mis</i> thì <I>mail-alert</i> sẽ chỉ được gọi với <I>mis</i> làm đối số của nó nếu giá trị thoát của chương trình màn hình nằm trong khoảng từ 10 đến 20. Tính năng này cho phép bạn kích hoạt cảnh báo khác nhau ở các mức độ nghiêm trọng khác nhau (như khi không gian đĩa trống tăng từ 8% đến 3%). <P> Xem phần <B>CHƯƠNG TRÌNH ALERT</b> ở trên để biết danh sách các pramaeter mon sẽ tự động chuyển đến các chương trình cảnh báo. <P><DT> <I>cảnh báo</i> <B>upalert</b> <I>[arg ...]</i> <DD> Một <B>upalert</b> là lời khen của một <B>cảnh báo</b> . Một upalert được gọi khi một dịch vụ làm cho quá trình chuyển trạng thái từ thất bại sang thành công. Tập lệnh <B>upalert</b> được gọi là cung cấp các tham số tương tự như tập lệnh <B>cảnh báo</b> , với việc thêm tham số <B>-u</b> được sử dụng đơn giản để cho tập lệnh cảnh báo biết rằng nó đang được gọi là tập lệnh upalert. Nhiều upalerts có thể được chỉ định cho từng định nghĩa thời gian. Xin lưu ý rằng hành vi mặc định là một upalert sẽ được gửi bất kể nếu có bất kỳ cảnh báo &quot;xuống&quot; nào trước đó, vì các upalerts được kích hoạt khi chuyển trạng thái. Đặt tùy chọn <B>comp_alerts theo</b> chu kỳ để ghép các cảnh báo với &quot;cảnh báo&quot; xuống. <P><DT> <I>cảnh báo</i> <B>khởi</b> <I>động [arg ...]</i> <DD> Một <B>startupalert</b> chỉ được gọi khi máy chủ <B>mon</b> bắt đầu thực thi. <P><DT> <B>upalertafter</b> <I>timeval</i> <DD> Tham số <B>upalertafter</b> được chỉ định là một chuỗi theo cú pháp của tham số <B>khoảng</b> (&quot;30s&quot;, &quot;1m&quot;, v.v.) và điều khiển kích hoạt một <B>upalert</b> . Nếu một dịch vụ quay trở lại sau khi ngừng hoạt động trong thời gian lớn hơn hoặc bằng giá trị của tùy chọn này, một <B>upalert</b> sẽ được gọi. Sử dụng tùy chọn này để ngăn chặn các cuộc gọi lên được gọi vì &quot;blips&quot; (mất điện ngắn). <P>