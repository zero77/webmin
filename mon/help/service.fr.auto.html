<header> Aide de MON sur les définitions de service </header><p> Il s&#39;agit de la deuxième et dernière étape de la configuration MON. <p> Les valeurs par défaut sont affichées pour les services obligatoires <marked in RED color> . Voir la rubrique d&#39;aide respective ci-dessous pour plus d&#39;aide sur les définitions de service. <p> Pour <b>&quot;mail.alert&quot;</b> , assurez-vous que le sendmail est configuré et que le démon <b>&quot;sendmail&quot;</b> est démarré sur la machine hôte. <H3> Définitions des services </H3><P><DL COMPACT><DT> <B>Service</b> <I>servicename</i> <DD> Une définition de service commence par le mot-clé <B>service</b> suivi d&#39;un mot qui est la balise de ce service. <P> Les composants d&#39;un service sont un intervalle, un moniteur et une ou plusieurs définitions de période, comme défini ci-dessous. <P> Si un nom de service &quot;par défaut&quot; est défini dans un groupe de surveillance appelé &quot;dafault&quot; (voir ci-dessus), la définition par défaut / par défaut sera utilisée pour gérer les pièges mon inconnus. <P><DT> <B>intervalle de</b> <I>temps</i> <DD> L&#39; <B>intervalle de</b> mot clé suivi d&#39;une valeur de temps spécifie la fréquence à laquelle un script de contrôle sera déclenché. Les valeurs de temps sont définies comme &quot;30s&quot;, &quot;5m&quot;, &quot;1h&quot; ou &quot;1d&quot;, ce qui signifie 30 secondes, 5 minutes, 1 heure ou 1 jour. La portion numérique peut être une fraction, telle que &quot;1,5 h&quot; ou une heure et demie. Ce format de spécification d&#39;heure sera appelé <I>temporel</i> . <P><DT> <B>traptimeout</b> <I>timeval</i> <DD> Ce mot - clé prend le même argument de spécification de temps d&#39; <B><I>intervalle,</i></b> et rend le service qu&#39;ils attendent , un piège à partir d&#39; une source externe au moins que , souvent, le reste sera enregistré un échec. Ceci est utilisé pour un service de style heartbeat. <P><DT> <B>trapduration</b> <I>timeval</i> <DD> Si une interruption est reçue, l&#39;état du service auquel l&#39;interruption a été livrée restera normalement constant. Si <B>trapduration</b> est spécifié, l&#39;état du service restera dans un état d&#39;échec pendant la durée spécifiée par <I>timeval</i> , puis il sera réinitialisé à &quot;succès&quot;. <P><DT> <B>randskew</b> <I>timeval</i> <DD> Plutôt que de planifier l&#39;exécution du script de contrôle au début de chaque intervalle, ajustez au hasard l&#39;intervalle spécifié par le paramètre d&#39; <B>intervalle</b> par <B>randskew</b> plus ou moins <B>.</b> La valeur est spécifiée skew comme paramètre d&#39; <B>intervalle:</b> « 30s », « 5m », etc ... Par exemple , si l&#39; <B>intervalle</b> est de 1 m, et <B>randskew</b> est « 5 secondes », puis <I>mon</i> programmera le script de contrôle du temps entre toutes les 55 secondes et 65 secondes. L&#39;objectif est d&#39;aider à répartir la charge sur le serveur lorsque de nombreux services sont planifiés aux mêmes intervalles. <P><DT> <B>moniteur</b> <I>nom-moniteur [arg ...]</i> <DD> Le mot-clé <B>moniteur</b> suivi d&#39;un nom de script et d&#39;arguments spécifie le moniteur à exécuter lorsque le temporisateur expire. Les conventions de citation de type shell sont suivies lors de la spécification des arguments à envoyer au script de contrôle. Le script est appelé à partir du répertoire fourni avec l&#39;argument <B>-s</b> , et tous les mots suivants sont fournis en tant qu&#39;arguments au programme moniteur, suivis de la liste des hôtes du groupe référencé par le groupe de surveillance actuel. Si la ligne du moniteur se termine par &quot;;;&quot; en tant que mot distinct, les groupes d&#39;hôtes ne sont pas ajoutés à la liste d&#39;arguments lorsque le programme est appelé. <P><DT> <B>allow_empty_group</b> <DD> L&#39;option <B>allow_empty_group</b> permettra à un moniteur d&#39;être invoqué même lorsque le groupe d&#39;hôtes pour cette surveillance est vide à cause des hôtes désactivés. Le comportement par défaut n&#39;est pas d&#39;appeler le moniteur lorsque tous les hôtes d&#39;un groupe d&#39;hôtes ont été désactivés. <P><DT> <B>description</b> <I>descriptiontext</i> <DD> Le texte qui suit la <B>description</b> est interrogé par les programmes clients, transmis aux alertes et aux moniteurs via une variable d&#39;environnement. Il doit contenir une brève description du service, pouvant être incluse dans un e-mail ou sur une page Web. <P><DT> <B>exclude_hosts</b> <I>host [hôte ...]</i> <DD> Tous les hôtes répertoriés après <B>exclude_hosts</b> seront exclus de la vérification de service. <P><DT> <B>exclude_period</b> <I>periodspec</i> <DD> <I>N&#39;exécutez</i> pas de moniteur planifié pendant la période identifiée par <I>periodspec</i> . <P><DT> <B>depend</b> <I>dependexpression</i> <DD> Le mot clé <B>depend</b> est utilisé pour spécifier une expression de dépendance, qui est évaluée à true ou false, au sens booléen. Les dépendances sont de véritables expressions Perl et doivent obéir à toutes les règles syntaxiques. Les expressions sont évaluées dans leur propre espace de package afin de ne pas avoir accidentellement des effets secondaires indésirables. Si une erreur de syntaxe est trouvée lors de l&#39;évaluation de l&#39;expression, elle est enregistrée via syslog. <P> Avant l&#39;évaluation, les substitutions suivantes de l&#39;expression se produisent: des phrases qui ressemblent à &quot;groupe: service&quot; sont remplacées par la valeur de l&#39;état opérationnel actuel de ce service spécifié. Ces substitutions d&#39;opstatus sont calculées de manière récursive, donc si le service A dépend du service B et le service B dépend du service C, alors le service A dépend du service C. Les états opérationnels réussis (qui s&#39;évaluent à &quot;1&quot;) sont &quot;STAT_OK&quot;, &quot;STAT_COLDSTART &quot;,&quot; STAT_WARMSTART &quot;et&quot; STAT_UNknown &quot;. Le mot &quot;SELF&quot; (dans toutes les majuscules) peut être utilisé pour le groupe (par exemple &quot;SELF: service&quot;), et est une abréviation pour le groupe de surveillance actuel. <P> Cette fonctionnalité peut être utilisée pour contrôler les alertes pour les services qui dépendent d&#39;autres services, par exemple un test SMTP qui dépend de la machine ping accessible. <P><DT> <B>dep_behavior</b> <I>{a | m}</i> <DD> L&#39;évaluation des graphiques de dépendance peut contrôler la suppression des alertes ou surveiller les invocations. <P> <B>Suppression des alertes</b> . Si cette option est définie sur &quot;a&quot;, l&#39;expression de dépendance sera évaluée après la sortie du moniteur pour le service ou après la réception d&#39;une interruption. Une alerte ne sera envoyée que si l&#39;évaluation réussit, ce qui signifie qu&#39;aucun des nœuds du graphique de dépendance n&#39;indique une défaillance. <P> <B>Surveillez la suppression</b> . S&#39;il est défini sur &quot;m&quot;, l&#39;expression de dépendance sera évaluée avant que le moniteur du service ne soit sur le point de s&#39;exécuter. Si l&#39;évaluation réussit, le moniteur sera exécuté. Sinon, le moniteur ne sera pas exécuté et l&#39;état du service restera le même. <P></DL><A NAME="lbAO">&nbsp;</A><H3> Définitions des périodes </H3><P> Les périodes sont utilisées pour définir les conditions qui doivent permettre de délivrer des alertes. <P><DL COMPACT><DT> <B>période</b> <I>[label:] periodspec</i> <DD> Une période regroupe une ou plusieurs alarmes et variables qui contrôlent la fréquence à laquelle une alerte se produit en cas de défaillance. Le mot <B>-</b> clé <B>period</b> a deux formes. Le premier prend un argument qui est une spécification de période du module Time :: Period Perl 5 de Patrick Ryan. Reportez-vous à &quot;perldoc Time :: Period&quot; pour plus d&#39;informations. <P> Le deuxième formulaire nécessite une étiquette suivie d&#39;une spécification de période, comme défini ci-dessus. L&#39;étiquette est une étiquette composée d&#39;un caractère alphabétique ou d&#39;un trait de soulignement suivi de zéro ou plusieurs caractères alphanumériques ou traits de soulignement et se terminant par deux points. Ce formulaire permet plusieurs périodes avec la même définition de période. Une utilisation consiste à avoir une définition de période qui n&#39;a pas de paramètres <B>alertafter</b> ou <B>alertevery</b> pour une période donnée, et une autre pour la même période avec un ensemble d&#39;alertes différent qui contient ces paramètres. <P><DT> <B>alertevery</b> <I>timeval</i> <DD> Le mot clé <B>alertevery</b> (dans une définition de <B>période</b> ) prend le même type d&#39;argument que la variable d&#39; <B>intervalle</b> et limite le nombre de fois qu&#39;une alerte est envoyée lorsque le service continue d&#39;échouer. Par exemple, si l&#39;intervalle est &quot;1h&quot;, seules les alertes de la section période ne seront déclenchées qu&#39;une fois toutes les heures. Si le mot clé <B>alertevery</b> est omis dans une entrée de période, une alerte sera envoyée chaque fois qu&#39;une défaillance est détectée. Par défaut, si la sortie de deux échecs successifs change, l&#39;intervalle alertevery est remplacé. Si le mot &quot;résumé&quot; est le dernier argument, alors seules les lignes de sortie récapitulatives seront prises en compte lors de la comparaison de la sortie des échecs successifs. <P><DT> <B>alertafter</b> <I>num</i> <DD><P><DT> <B>alertafter</b> <I>num timeval</i> <DD> Le mot clé <B>alertafter</b> (dans une section de <B>période</b> ) a deux formes: uniquement avec l&#39;argument &quot;num&quot; ou avec les arguments &quot;num timeval&quot;. Dans le premier formulaire, une alerte ne sera invoquée qu&#39;après &quot;num&quot; échecs consécutifs. <P> Dans la deuxième forme, les arguments sont un entier positif suivi d&#39;un intervalle, comme décrit par la variable d&#39; <B>intervalle</b> ci-dessus. Si ces paramètres sont spécifiés, les alertes pour cette période ne seront appelées qu&#39;après que de nombreux échecs se produisent dans cet intervalle. Par exemple, si <B>alertafter</b> reçoit les arguments &quot;3 30m&quot;, l&#39;alerte sera appelée si 3 échecs se produisent dans les 30 minutes. <P><DT> <B>numalerts</b> <I>num</i> <DD><P> Cette variable indique au serveur d&#39;appeler pas plus de <I>num</i> alertes lors d&#39;un échec. Le compteur d&#39;alertes est conservé par période et est réinitialisé à chaque succès. <P><DT> <B>comp_alerts</b> <DD><P> Si cette option est spécifiée, les upalerts ne seront appelés que si une alerte &quot;down&quot; correspondante a été appelée. <P><DT> <B>alerte</b> <I>alerte [arg ...]</i> <DD> Une période peut contenir plusieurs alertes, qui sont déclenchées en cas d&#39;échec du service. Une alerte est spécifiée avec le mot clé <B>alert</b> , suivi d&#39;un paramètre de <B>sortie</b> facultatif et d&#39;arguments qui sont interprétés de la même manière que la définition du <B>moniteur</b> , mais sans le &quot;;;&quot; exception. Le paramètre <B>exit</b> prend la forme <B>exit = x</b> ou <B>exit = xy</b> et a pour effet que l&#39;alerte n&#39;est appelée que si l&#39;état de sortie du script de contrôle se situe dans la plage du paramètre <B>exit</b> . Si, par exemple, la ligne d&#39;alerte est <I>alert exit = 10-20 mail.alert mis,</i> alors <I>mail-alert</i> ne sera invoqué avec <I>mis</i> comme argument que si la valeur de sortie du programme de surveillance se situe entre 10 et 20. Cette fonction vous permet de déclencher différentes alertes à différents niveaux de gravité (comme lorsque l&#39;espace disque disponible passe de 8% à 3%). <P> Voir la section <B>PROGRAMMES D&#39;ALERTE</b> ci-dessus pour une liste des paramètres qui passeront automatiquement aux programmes d&#39;alerte. <P><DT> <I>alerte</i> <B>upalert</b> <I>[arg ...]</i> <DD> Un <B>upalert</b> est le complément d&#39;une <B>alerte</b> . Un upalert est appelé lorsqu&#39;un service fait la transition d&#39;état de l&#39;échec au succès. Le script <B>upalert</b> est appelé fournissant les mêmes paramètres que le script <B>alert</b> , avec l&#39;ajout du paramètre <B>-u</b> qui est simplement utilisé pour faire savoir à un script alert qu&#39;il est appelé comme upalert. Plusieurs upalerts peuvent être spécifiés pour chaque définition de période. Veuillez noter que le comportement par défaut est qu&#39;un upalert sera envoyé peu importe si des alertes &quot;down&quot; ont été envoyées, car les upalerts sont déclenchés lors d&#39;une transition d&#39;état. Définissez l&#39;option <B>comp_alerts</b> par période pour associer les upalerts aux alertes &quot;down&quot;. <P><DT> <I>alerte</i> <B>startupalert</b> <I>[arg ...]</i> <DD> Un <B>startupalert</b> n&#39;est appelé que lorsque le serveur <B>mon</b> démarre l&#39;exécution. <P><DT> <B>upalertafter</b> <I>timeval</i> <DD> Le paramètre <B>upalertafter</b> est spécifié sous la forme d&#39;une chaîne qui suit la syntaxe du paramètre <B>intervalle</b> (&quot;30s&quot;, &quot;1m&quot;, etc.) et contrôle le déclenchement d&#39;une <B>upalert</b> . Si un service revient après avoir été arrêté pendant un temps supérieur ou égal à la valeur de cette option, un <B>upalert</b> sera appelé. Utilisez cette option pour empêcher les appels d&#39;upalerts à cause de &quot;blips&quot; (brèves pannes). <P>