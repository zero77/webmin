<header> Даведка MON па азначэннях службы </header><p> Гэта другі і апошні этап канфігурацыі MON. <p> Значэнні па змаўчанні паказаны для абавязковых паслуг <marked in RED color> . Гл. Адпаведную тэму даведкі ніжэй, каб атрымаць дадатковую дапамогу ў вызначэннях службы. <p> Для <b>&quot;mail.alert&quot;</b> пераканайцеся, што sendmail настроены і <b>&quot;sendmail&quot;</b> дэман будзе запушчаны на хост-машыне. <H3> Вызначэнні службы </H3><P><DL COMPACT><DT> <I>Імя</i> <B>службы</b> <DD> Азначэнне службы пачынаецца з <B>службы</b> па ключавых словах, пасля чаго варта слова, якое з&#39;яўляецца тэгам для гэтай службы. <P> Кампаненты паслугі - гэта інтэрвал, манітор і адно або некалькі вызначэнняў часовага перыяду, як вызначана ніжэй. <P> Калі імя службы &quot;па змаўчанні&quot; вызначана ў групе назірання, званай &quot;dafault&quot; (гл. Вышэй), то для апрацоўкі невядомых пасткоў будзе выкарыстоўвацца вызначэнне па змаўчанні / па змаўчанні. <P><DT> <B>інтэрвал</b> <I>часу</i> <DD> <B>Інтэрвал</b> ключавых слоў, які суправаджаецца значэннем часу, указвае, на якую частату будзе запушчаны сцэнар манітора. Значэнні часу вызначаюцца як &quot;30s&quot;, &quot;5m&quot;, &quot;1h&quot; або &quot;1d&quot;, што азначае 30 секунд, 5 хвілін, 1 гадзіну або 1 дзень. Лікавая частка можа быць дробу, напрыклад, &quot;1,5h&quot; ці гадзіну з паловай. Гэты фармат часовай спецыфікацыі будзе называцца <I>часовым тэрмінам</i> . <P><DT> <B>traptimeout</b> <I>фармату</i> : першы <I>фармат</i> <DD> Гэта ключавое слова прымае той жа аргумент спецыфікацыі <B>часу</b> <I>, што</i> і <B>інтэрвал</b> <I>,</i> і прымушае службу чакаць пасткі ад знешняй крыніцы хаця б часта, інакш збой будзе зарэгістраваны. Гэта выкарыстоўваецца для сэрцабіцця. <P><DT> <B>таймвал</b> <I>трапдурацыі</i> <DD> Калі пастка атрымана, статус службы, у якую пастаўлена пастка, застанецца пастаянным. Калі <B>пастка</b> будзе паказана, статус службы застанецца ў стане адмовы на працягу ўсяго часу, вызначанага <I>таймвалам</i> , і тады ён будзе скінуты да &quot;поспеху&quot;. <P><DT> <B>рандсэў</b> <I>таймвал</i> <DD> Замест таго, каб запланаваць выкананне сцэнарыя манітора ў пачатку кожнага інтэрвалу, <B>адрэдагуйце</b> выпадковы інтэрвал, пазначаны параметрам <B>інтэрвалу,</b> праз <B>радкі</b> плюс-мінус <B>.</b> Значэнне перакосу паказана ў якасці параметра <B>інтэрвалу</b> : &quot;30s&quot;, &quot;5m&quot; і г.д. ... Напрыклад, калі <B>інтэрвал</b> складае 1 м, а <B>рэндсайк</b> - &quot;5s&quot;, то <I>пн</i> плануе сцэнар манітора некаторы час паміж кожнымі 55 секундамі і 65 секунд. Намер складаецца ў тым, каб дапамагчы размеркаваць нагрузку на сервер, калі многія службы запланаваны з аднолькавымі інтэрваламі. <P><DT> <B>манітор</b> <I>-імя манітора [арг ...]</i> <DD> <B>Манітор</b> ключавых слоў з імем сцэнарыя і аргументамі вызначае запуск манітора, калі мінае таймер. Пры ўказанні аргументаў для адпраўкі ў сцэнар манітора выконваюцца ўмоўныя параметры цытавання. Скрыпт выклікаецца з каталога, прыведзенага з аргументам <B>-s</b> , і ўсе наступныя словы падаюцца ў якасці аргументаў маніторнай праграме, пасля чаго спіс хостаў у групе, на якую спасылаецца бягучая група назірання. Калі радок манітора заканчваецца &quot;;;&quot; як асобнае слова, прымаючыя групы не дадаюцца ў спіс аргументаў, калі выклікаецца праграма. <P><DT> <B>enable_empty_group</b> <DD> Параметр <B>enable_empty_group</b> дазволіць выклікаць манітор нават тады, калі група хастоў для гэтага гадзінніка пустая з-за адключэння хастоў. Паводзіны па змаўчанні не выклікае манітор, калі ўсе хасты ў групе хастоў былі адключаныя. <P><DT> <B>апісанне</b> <I>апісання</i> <DD> У наступным <B>апісанні</b> тэкст запытваецца кліентамі, перадаецца апавяшчэнням і маніторам праз зменную сераду. Ён павінен змяшчаць кароткае апісанне паслугі, прыдатнае для ўключэння ў электронную пошту ці на вэб-старонку. <P><DT> <B>исключить_хосты</b> <I>хоста [хост ...]</i> <DD> Любыя <B>хосты,</b> пералічаныя пасля <B>enablee_hosts,</b> будуць выключаны з праверкі службы. <P><DT> <B>выключыць</b> <I>перыядыперыяд перыяду</i> <DD> Не запускайце планавы манітор на працягу перыяду, вызначанага <I>перыядамі</i> . <P><DT> <B>залежыць ад</b> <I>экспрэсіі</i> <DD> Ключавое слова <B>залежыць</b> , каб вызначыць выраз залежнасці, які ў булевым сэнсе ацэньвае як сапраўднае ілжывае. Залежнасці з&#39;яўляюцца фактычнымі выразамі Perl і павінны выконваць усе сінтаксічныя правілы. Выразы ацэньваюцца ва ўласнай прасторы пакета, каб выпадкова не ўзнікнуць нейкія непажаданыя пабочныя эфекты. Калі пры ацэнцы выразу выяўлена памылка сінтаксісу, яна рэгіструецца праз syslog. <P> Перад ацэнкай адбываюцца наступныя падмены выразу: фразы, якія выглядаюць як &quot;група: служба&quot;, падмяняюцца значэннем бягучага аператыўнага стану гэтай зададзенай службы. Гэтыя замены opstatus вылічваюцца рэкурсіўна, таму калі служба A залежыць ад службы B, а служба B залежыць ад службы C, то служба A залежыць ад службы C. Паспяховыя працоўныя стану (якія ацэньваюцца як &quot;1&quot;) &quot;STAT_OK&quot;, &quot;STAT_COLDSTART &quot;,&quot; STAT_WARMSTART &quot;і&quot; STAT_UNKNOWN &quot;. Слова &quot;SELF&quot; (ва ўсіх шапках) можа выкарыстоўвацца для групы (напрыклад, &quot;SELF: service&quot;) і з&#39;яўляецца абрэвіятурай для бягучай групы гадзін. <P> Гэтая функцыя можа быць выкарыстана для кіравання апавяшчэннямі аб службах, якія залежаць ад іншых службаў, напрыклад, тэст SMTP, які залежыць ад магчымасці пінг-доступу машыны. <P><DT> <B>dep_behavior</b> <I>{a | m}</i> <DD> Ацэнка графікаў залежнасці можа кантраляваць падаўленне альбо папярэджання, альбо кантролю выклікаў. <P> <B>Падаўленне апавяшчэнняў</b> . Калі гэты параметр усталяваны ў &quot;а&quot;, то выраз залежнасці будзе ацэнены пасля выхаду манітора ад службы або пасля пасткі. Папярэджанне будзе адпраўлена толькі ў выпадку паспяховай ацэнкі, што азначае, што ні адзін з вузлоў графіка залежнасці не паказвае на адмову. <P> <B>Кантраляваць падаўленне</b> . Калі ён усталяваны ў &quot;m&quot;, то выраз залежнасці будзе эвалюцыянаваны да таго, як манітор службы будзе запушчаны. Калі эвакуацыя атрымаецца, манітор будзе запушчаны. У адваротным выпадку манітор не будзе запушчаны, і статус службы застанецца ранейшым. <P></DL><A NAME="lbAO">&nbsp;</A><H3> Азначэнні перыяду </H3><P> Перыяды выкарыстоўваюцца для вызначэння ўмоў, якія павінны забяспечваць дастаўку папярэджанняў. <P><DL COMPACT><DT> <B>перыяд</b> <I>[label:] periodpec</i> <DD> Перыяд аб&#39;ядноўвае адзін ці некалькі сігналізацый і зменных, якія кантралююць, як часта адбываецца папярэджанне, калі адбываецца збой. Ключавое слова <B>перыяду</b> мае дзве формы. Першы прымае аргумент, які з&#39;яўляецца спецыфікацыяй перыяду з модуля Патрык Райан Час :: Перыяд 5 Perl. Звярніцеся да &quot;Час perldoc :: Перыяд&quot; для атрымання дадатковай інфармацыі. <P> Другая форма патрабуе этыкеткі з наступнай спецыфікацыяй перыяду, як вызначана вышэй. Этыкетка - гэта пазнака, якая складаецца з алфавітнага знака альбо падкрэслівання, які суправаджаецца нулявой ці вялікай колькасцю алфавітна-лічбавых знакаў і падкрэсліванняў і заканчваецца двукроп&#39;е. Гэтая форма дазваляе некалькі перыядаў з аднолькавым вызначэннем перыяду. <B>Першае</b> выкарыстанне - гэта вызначэнне перыяду, у якім няма <B>параметраў апавяшчэння</b> альбо <B>абвесткі</b> на працягу пэўнага перыяду часу, а іншае для таго ж перыяду часу з розным наборам абвесткі, якое ўтрымлівае гэтыя параметры. <P><DT> <B>timeval</b> <I>alarm</i> <DD> <B>Ключавое</b> слова папярэджання (у межах вызначэння <B>перыяду</b> ) прымае аргумент таго ж тыпу, што і <B>інтэрвальная</b> пераменная, і абмяжоўвае колькасць разоў адпраўкі папярэджання, калі служба працягвае адмовіцца. Напрыклад, калі інтэрвал складае &quot;1h&quot;, то толькі папярэджання ў раздзеле перыяду будуць запускацца толькі раз у гадзіну. Калі ў <B>запісе перыяду апушчана</b> ключавое слова апавяшчэння, апавяшчэнне будзе рассылацца кожны раз пры выяўленні няспраўнасці. Па змаўчанні, калі выснова двух паслядоўных збояў змяняецца, то інтэрвал абвесткі будзе адменены. Калі слова &quot;рэзюмэ&quot; з&#39;яўляецца апошнім аргументам, то пры параўнанні вынікаў паслядоўных адмоваў будуць разглядацца толькі зводныя радкі. <P><DT> <B>alertafter</b> <I>Num</i> <DD><P><DT> <B>папярэдні</b> <I>нумар timeval</i> <DD> <B>Ключавое</b> слова <B>апавяшчэння</b> (у раздзеле <B>перыяду</b> ) мае дзве формы: толькі з аргументам &quot;num&quot; альбо з аргументамі &quot;num timeval&quot;. У першай форме апавяшчэнне будзе выклікана толькі пасля адмоў паслядоўнага &quot;нумаравання&quot;. <P> У другой форме аргументы ўяўляюць сабой натуральнае цэлае лік з наступным інтэрвалам, як апісана пераменная <B>інтэрвалу</b> вышэй. Калі гэтыя параметры зададзены, то апавяшчэнні за гэты перыяд будуць выкліканы толькі пасля таго, як у гэты інтэрвал здарыцца шмат адмоваў. Напрыклад, калі <B>апавяшчальніку</b> прыведзены аргументы &quot;3 30 м&quot;, то папярэджанне будзе выклікана, калі на працягу 30 хвілін здарыцца 3 адмовы. <P><DT> <B>numalerts</b> <I>num</i> <DD><P> Гэтая зменная загадвае сервер выклікаць няспраўнасць <I>сігналізацыі</i> не больш за нумар. Лічыльнік папярэджанняў праводзіцца перыядычна і аднаўляецца пасля кожнага поспеху. <P><DT> <B>comp_alerts</b> <DD><P> Калі ўказана гэтая опцыя, вызовы upalerts будуць выкліканыя толькі ў тым выпадку, калі было выклікана адпаведнае папярэджанне &quot;ўніз&quot;. <P><DT> <B>абвестка аб</b> <I>папярэджанні [арг ...]</i> <DD> Перыяд можа ўтрымліваць некалькі апавяшчэнняў, якія запускаюцца пры адмове паслугі. Апавяшчэнне паказваецца з ключавым словам <B>папярэджання</b> , а затым дадатковым параметрам <B>выхаду</b> і аргументамі, якія інтэрпрэтуюцца так жа, як вызначэнне <B>манітора</b> , але без &quot;;&quot; выключэнне. Параметр <B>выхаду</b> мае выгляд <B>exit = x</b> або <B>exit = xy</b> і азначае, што папярэджанне выклікаецца толькі ў тым выпадку, калі статус выхаду сцэнарыя манітора трапляе ў дыяпазон параметра <B>выхаду</b> . Калі, напрыклад, радок абвесткі выклікае <I>выхад абвесткі = 10-20 mail.alert mis,</i> то ў выглядзе <I>павароту</i> <I>паведамлення электроннай пошты</i> будзе выклікана <I>памылка толькі</i> ў тым выпадку, калі значэнне выхаду праграмы манітора складае ад 10 да 20. Гэтая функцыя дазваляе запускаць розныя абвесткі пры рознай ступені выяўленасці (напрыклад, калі вольная прастора на дыску пераходзіць ад 8% да 3%). <P> Глядзіце раздзел АЛЕРТНЫЯ <B>ПРАГРАМЫ</b> вышэй, спіс спісаў праматэрыялаў аўтаматычна перадаецца праграмам абвесткі. <P><DT> <I>апавяшчэнне пра</i> <B>upalert</b> <I>[</i> <B>арг</b> <I>...]</i> <DD> <B>Упалерт</b> - камплімент <B>папярэджання</b> . Упалерт называецца, калі паслугі пераходзяць стан ад правалу да поспеху. Скрыпт <B>upalert</b> называецца тым самым параметрам, што і скрыпт <B>папярэджання</b> , з даданнем параметра <B>-u,</b> які проста выкарыстоўваецца, каб скрыпт папярэджання ведаў, што ён выклікаецца upalert. Для кожнага вызначэння перыяду могуць быць паказаны некалькі ўпалераў. Звярніце ўвагу, што паводзіны па змаўчанні - гэта адпраўка upalert незалежна ад таго, ці былі адпраўленыя папярэднія апавяшчэнні аб &quot;зніжэнні&quot;, бо пры пераходзе стану запускаюцца ўпаэрты. Усталюйце опцыю <B>comp_alerts</b> за <B>пэрыядычны</b> перыяд, каб злучыць упарлеры з папярэджаннямі «ўніз». <P><DT> <I>папярэджання</i> <B>startupalert</b> <I>[</i> <B>арг</b> <I>...]</i> <DD> <B>Запуск запуску</b> выклікаецца толькі тады, калі сервер <B>mon</b> пачынае выконваць. <P><DT> <B>upalertafter</b> <I>timeval</i> <DD> Параметр <B>upalertafter</b> паказваецца ў выглядзе радка, якая сочыць за сінтаксісам параметра <B>інтэрвалу</b> (&quot;30s&quot;, &quot;1m&quot; і г.д.) і кіруе <B>запускам upalert</b> . Калі паслуга вяртаецца пасля <B>спынення</b> на час, які перавышае або роўны значэнню гэтай опцыі, будзе выкліканы <B>upalert</b> . Выкарыстоўвайце гэтую опцыю, каб пазбегнуць выкліку upalerts з-за &quot;прарываў&quot; (кароткачасовых адключэнняў). <P>