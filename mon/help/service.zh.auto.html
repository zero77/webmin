<header> MON服务定义帮助</header><p>这是MON配置的第二个也是最后一个阶段。 <p>显示强制性服务的默认值<marked in RED color> 。请参阅下面的相应帮助主题，以获取有关服务定义的更多帮助。 <p>对于<b>“ mail.alert”</b> ，请确保已配置<b>sendmail</b>并在主机上启动了<b>“ sendmail”</b>守护进程。 <H3>服务定义</H3><P><DL COMPACT><DT> <B>服务</b> <I>SERVICENAME</i> <DD>服务定义以关键字<B>service</b>开头，后跟单词即该服务的标签。 <P>服务的组成部分包括时间间隔，监视器以及一个或多个时间段定义，如下所示。 <P>如果在名为“ dafault”的监视组中定义了“默认”服务名称（请参见上文），则默认/默认定义将用于处理未知的mon陷阱。 <P><DT> <B>间隔</b> <I>的timeval</i> <DD>关键字<B>间隔</b>后跟一个时间值，指定触发监视脚本的频率。时间值定义为“ 30s”，“ 5m”，“ 1h”或“ 1d”，表示30秒，5分钟，1小时或1天。数字部分可以是分数，例如“ 1.5h”或一个半小时。时间规范的这种格式将称为<I>timeval</i> 。 <P><DT> <B>traptimeout</b> <I>的timeval</i> <DD>此关键字采用与<B>interval</b>相同的时间指定参数<I>，</i>并使服务至少经常期望来自外部源的陷阱，否则将记录失败。这用于心跳式服务。 <P><DT> <B>trapduration</b> <I>的timeval</i> <DD>如果收到陷阱，则陷阱被传递到的服务的状态通常将保持不变。如果指定了<B>trapduration</b> ，则服务的状态将在<I>timeval</i>指定的持续时间内保持失败状态，然后将其重置为“成功”。 <P><DT> <B>randskew</b> <I>timeval</i> <DD>而不是安排监视脚本在每个间隔开始时运行，而是通过正负<B>randskew</b>随机调整<B>interval</b>参数指定的<B>间隔</b> <B>。</b>偏斜值指定为<B>interval</b>参数：“ 30s”，“ 5m”等。例如，如果<B>interval</b>为1m， <B>randskew</b>为“ 5s”，则<I>mon</i>将在每55秒和65秒目的是在以相同的时间间隔计划许多服务时，帮助在服务器上分配负载。 <P><DT> <B>monitor</b> <I>monitor-name [arg ...]</i> <DD>关键字<B>Monitor</b>后跟脚本名称和参数指定了计时器到期时要运行的监视器。指定要发送到监视脚本的参数时，遵循类似Shell的引用约定。该脚本是从<B>-s</b>参数给定的目录中调用的，随后的所有单词均作为该监视程序的参数提供，随后是当前监视组所引用的组中的主机列表。如果监视行以“ ;;”结尾作为一个单独的词，在调用程序时，主机组不会附加到参数列表中。 <P><DT> <B>allow_empty_group</b> <DD>即使由于监视的主机而导致该监视的主机组为空， <B>allow_empty_group</b>选项也将允许调用监视器。禁用主机组中的所有主机后，默认行为是不调用监视器。 <P><DT> <B>描述</b> <I>descriptiontext</i> <DD>客户端程序查询以下<B>描述</b>的文本，并通过环境变量将其传递给警报和监视器。它应包含该服务的简短说明，适合包含在电子邮件或网页中。 <P><DT> <B>exclude_hosts</b> <I>主机[主机...]</i> <DD>在<B>exclude_hosts</b>之后列出的所有主机将从服务检查中排除。 <P><DT> <B>exclude_period</b> <I>periodspec</i> <DD>不要在<I>periodspec</i>标识的时间内运行计划的监视器。 <P><DT> <B>依赖</b> <I>dependexpression</i> <DD> <B>Depend</b>关键字用于指定依赖项表达式，在布尔意义上，该表达式的值为true或false。依赖关系是Perl的实际表达式，必须遵守所有语法规则。表达式在其自己的程序包空间中求值，以免意外地产生一些不需要的副作用。如果在评估表达式时发现语法错误，则会通过syslog记录该错误。 <P>在求值之前，对表达式进行以下替换：看起来像“ group：service”的短语将替换为该指定服务的当前操作状态的值。这些opstatus替换是递归计算的，因此，如果服务A依赖于服务B，并且服务B依赖于服务C，则服务A依赖于服务C。成功的操作状态（评估为“ 1”）为“ STAT_OK”，“ STAT_COLDSTART” ”，“ STAT_WARMSTART”和“ STAT_UNKNOWN”。单词“ SELF”（大写）可用于该组（例如“ SELF：service”），是当前监视组的缩写。 <P>此功能可用于控制依赖于其他服务的服务的警报，例如，依赖于可ping通的计算机的SMTP测试。 <P><DT> <B>dep_behavior</b> <I>{a | m}</i> <DD>依赖图的评估可以控制警报或监视调用的抑制。 <P> <B>警报抑制</b> 。如果将此选项设置为“ a”，则在退出服务的监视器或接收到陷阱之后，将对依赖项表达式求值。仅在评估成功时才发送警报，这意味着依赖关系图中的任何节点均未指示失败。 <P> <B>监视抑制</b> 。如果将其设置为“ m”，则将在将要运行该服务的监视器之前撤消依赖项表达式。如果评估成功，则将运行监视器。否则，监视器将不会运行，并且服务状态将保持不变。 <P></DL><A NAME="lbAO">&nbsp;</A><H3>期间定义</H3><P>使用句点来定义应该允许发送警报的条件。 <P><DL COMPACT><DT> <B>期间</b> <I>[标签：] periodspec</i> <DD>句点将一个或多个警报和变量分组，这些变量和变量控制发生故障时警报发生的频率。 <B>period</b>关键字有两种形式。第一个参数是Patrick Ryan的Time :: Period Perl 5模块中的周期规范。有关更多信息，请参见“ perldoc Time :: Period”。 <P>第二种形式需要一个标签，后跟一个周期说明，如上所述。该标签是由字母字符或下划线后跟零个或多个字母数字或下划线并以冒号结尾的标签。此格式允许具有相同期间定义的多个期间。一种用途是具有一个期间定义，该定义在特定时间段内不具有<B>Alertafter</b>或<B>Alertevery</b>参数，另一种用途是在相同时间段内具有确实包含那些参数的一组不同的警报。 <P><DT> <B>alertevery的</b> <I>的timeval</i> <DD> <B>alertevery</b>关键字（在<B>周期</b>定义内）采用与<B>interval</b>变量相同的参数类型，并限制服务继续失败时发送警报的次数。例如，如果间隔为“ 1h”，则仅时段部分中的警报仅每小时触发一次。如果在期间条目中省略<B>alertevery</b>关键字，则每次检测到故障时都会发出警报。默认情况下，如果两个连续故障的输出发生变化，则警报间隔将被覆盖。如果单词“ summary”是最后一个参数，则在比较连续失败的输出时，仅考虑摘要输出行。 <P><DT> <I>num之后的</i> <B>警报</b> <DD><P><DT> <I>num timeval之后</i> <B>发出警报</b> <DD> <B>alertafter</b>关键字（在<B>句点</b>部分）具有两种形式：仅带有“ num”参数，或者带有“ num timeval”参数。在第一种形式中，仅在“ num”个连续失败之后才调用警报。 <P>在第二种形式中，自变量是一个正整数，后跟一个间隔，如上面的<B>interval</b>变量所述。如果指定了这些参数，则仅在该时间间隔内发生许多故障之后才调用该时间段的警报。例如，如果将<B>alertafter</b>的参数设置为“ 3 30m”，则如果在30分钟内发生3次故障，则将调用警报。 <P><DT> <B>numalerts</b> <I>num</i> <DD><P>此变量告诉服务器在故障期间最多调用<I>num个</i>警报。警报计数器会定期保存，并在每次成功后重置。 <P><DT> <B>comp_alerts</b> <DD><P>如果指定了此选项，则仅在调用了相应的“关闭”警报时才调用upalerts。 <P><DT> <B>警报</b> <I>警报[arg ...]</i> <DD>一个期间可能包含多个警报，这些警报在服务失败时触发。用<B>alert</b>关键字指定一个警报，后跟一个可选的<B>退出</b>参数，以及与<B>监视器</b>定义解释相同的参数，但不带“ ;;”。例外。 <B>exit</b>参数采用<B>exit = x</b>或<B>exit = xy</b>的形式，其作用是仅在监视脚本的退出状态落在<B>exit</b>参数范围内时才调用警报。例如，如果警报行是<I>alert exit = 10-20 mail.alert mis，</i>则仅当监视程序的退出值在10到20之间时，才使用<I>mis</i>作为参数来调用<I>mail-alert。</i>此功能允许您触发不同严重性级别的警报（例如可用磁盘空间从8％变为3％时）。 <P>请参阅上面的<B>ALERT PROGRAMS（警报程序）</b>部分，以获取将自动传递到警报程序的pramaeters列表。 <P><DT> <B>upalert</b> <I>警报[arg ...]</i> <DD> <B>警报</b>是对<B>警报</b>的称赞。当服务使状态从失败转变为成功时，将调用upalert。 <B>upalert</b>脚本被称为提供与<B>警报</b>脚本相同的参数，并附加了<B>-u</b>参数，该参数仅用于使警报脚本知道它被称为upalert。可以为每个期间定义指定多个upalerts。请注意，默认行为是，无论之前是否发送过任何“关闭”警报，都将发送upalert，因为upalert在状态转换时触发。设置每个周期的<B>comp_alerts</b>选项，以将upalerts与“ down”警报配对。 <P><DT> <B>startupalert</b> <I>警报[arg ...]</i> <DD>仅在<B>mon</b>服务器开始执行时才调用<B>startupalert</b> 。 <P><DT> <B>upalertafter</b> <I>的timeval</i> <DD> <B>upalertafter</b>参数被指定为遵循<B>interval</b>参数的语法的字符串（“ 30s”，“ 1m”等），并控制<B>upalert</b>的触发。如果服务在关闭时间大于或等于此选项的值后<B>重新启动，</b>则将调用<B>upalert</b> 。使用此选项可以防止由于“故障”（简短中断）而导致向上警报被调用。 <P>