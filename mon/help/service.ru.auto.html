<header> Справка MON по определениям сервисов </header><p> Это второй и последний этап настройки MON. <p> Значения по умолчанию показаны для обязательных услуг <marked in RED color> , См. Соответствующий раздел справки ниже для получения дополнительной справки по определениям сервисов. <p> Для <b>«mail.alert»</b> убедитесь, что sendmail настроен и на хост-машине запущен демон <b>«sendmail»</b> . <H3> Определения услуг </H3><P><DL COMPACT><DT> <B>служба</b> <I>имя_служба</i> <DD> Определение сервиса начинается с ключевого слова <B>service,</b> за которым следует слово, являющееся тегом для этого сервиса. <P> Компонентами службы являются интервал, монитор и одно или несколько определений периода времени, как определено ниже. <P> Если имя службы «default» определено в группе наблюдения под названием «dafault» (см. Выше), тогда для обработки неизвестных ловушек будет использоваться определение по умолчанию / по умолчанию. <P><DT> <B>интервал</b> <I>времени</i> <DD> <B>Интервал</b> ключевого слова, за которым следует значение времени, указывает частоту запуска сценария монитора. Значения времени определяются как «30 с», «5 м», «1 ч» или «1 д», что означает 30 секунд, 5 минут, 1 час или 1 день. Числовая часть может быть дробью, такой как «1,5 часа» или полтора часа. Этот формат спецификации времени будет называться <I>timeval</i> . <P><DT> <B>время</b> <I>ожидания</i> <DD> Это ключевое слово принимает тот же аргумент спецификации <B>времени</b> <I>, что</i> и <B>интервал</b> <I>,</i> и заставляет службу ожидать прерывания от внешнего источника, по крайней мере, так часто, иначе будет зарегистрирован сбой. Это используется для службы сердцебиения. <P><DT> <B>время</b> <I>трапдурации</i> <DD> Если получено прерывание, статус службы, в которую было доставлено прерывание, обычно остается постоянным. Если <B>указано trapduration</b> , состояние службы будет оставаться в состоянии сбоя в течение периода времени, указанного в <I>timeval</i> , а затем оно будет сброшено на «успех». <P><DT> <B>рандскев</b> <I>таймваль</i> <DD> Вместо того, чтобы планировать выполнение сценария монитора в начале каждого интервала, случайным образом отрегулируйте интервал, заданный параметром <B>interval,</b> на плюс-минус <B>randskew.</b> Значение перекоса указывается в качестве параметра <B>интервала</b> : «30 с», «5 м» и т. Д. Например, если <B>интервал</b> равен 1 м, а <B>randskew</b> равен «5 с», то <I>mon</i> будет планировать сценарий монитора некоторое время между каждыми 55 секундами и 65 секунд Цель состоит в том, чтобы помочь распределить нагрузку на сервер, когда многие службы запланированы с одинаковыми интервалами. <P><DT> <B>монитор</b> <I>имя монитора [arg ...]</i> <DD> Ключевое слово <B>monitor,</b> за которым следуют имя сценария и аргументы, указывает монитор, запускаемый по истечении таймера. При указании аргументов для отправки скрипту монитора следуют соглашения о цитировании в виде оболочки. Сценарий вызывается из каталога, заданного аргументом <B>-s</b> , и все последующие слова передаются программе-монитору в качестве аргументов, после чего следует список хостов в группе, на которую ссылается текущая группа наблюдения. Если строка монитора заканчивается на «;;» как отдельное слово, группы хостов не добавляются в список аргументов при вызове программы. <P><DT> <B>allow_empty_group</b> <DD> Опция <B>allow_empty_group</b> позволяет вызывать монитор, даже когда группа хостов для этих часов пуста из-за отключенных хостов. Поведение по умолчанию - не вызывать монитор, когда все узлы в группе узлов отключены. <P><DT> <B>описание</b> <I>описаниетекст</i> <DD> Текст, следующий за <B>описанием</b> , запрашивается клиентскими программами, передается в оповещения и мониторы через переменную среды. Он должен содержать краткое описание услуги, подходящее для включения в электронное письмо или на веб-страницу. <P><DT> <I>хост</i> <B>exclude_hosts</b> <I>[хост ...]</i> <DD> Любые хосты, перечисленные после <B>exclude_hosts,</b> будут исключены из проверки сервиса. <P><DT> <B>exclude_period</b> <I>periodpec</i> <DD> Не запускайте запланированный монитор в течение времени, определенного <I>периодом</i> . <P><DT> <B>зависит зависимость</b> <I>выражение</i> <DD> Ключевое слово <B>зависимость</b> используется для указания выражения зависимости, которое оценивается как истинное или ложное в логическом смысле. Зависимости являются фактическими выражениями Perl и должны подчиняться всем синтаксическим правилам. Выражения оцениваются в собственном пространстве пакета, чтобы случайно не иметь нежелательного побочного эффекта. Если при вычислении выражения обнаружена синтаксическая ошибка, она регистрируется через системный журнал. <P> Перед оценкой выполняются следующие замены в выражении: фразы, которые выглядят как «группа: служба», заменяются значением текущего рабочего состояния указанной службы. Эти замены в опстатусе вычисляются рекурсивно, поэтому, если служба A зависит от службы B, а служба B зависит от службы C, тогда услуга A зависит от службы C. Успешными операционными состояниями (которые оцениваются как «1») являются «STAT_OK», «STAT_COLDSTART &quot;,&quot; STAT_WARMSTART &quot;и&quot; STAT_UNKNOWN &quot;. Слово «SELF» (во всех заглавных буквах) может использоваться для группы (например, «SELF: service») и является сокращением для текущей группы наблюдения. <P> Эта функция может использоваться для управления оповещениями для сервисов, которые зависят от других сервисов, например, теста SMTP, который зависит от того, доступен ли компьютер для проверки связи. <P><DT> <B>dep_behavior</b> <I>{a | m}</i> <DD> Оценка графиков зависимостей может контролировать подавление вызовов предупреждений или мониторинга. <P> <B>Подавление оповещения</b> . Если для этого параметра установлено значение «a», выражение зависимости будет оцениваться после выхода из монитора службы или после получения прерывания. Предупреждение будет отправлено только в случае успешной оценки, что означает, что ни один из узлов на графике зависимостей не указывает на сбой. <P> <B>Контроль подавления</b> . Если для него задано значение «m», выражение зависимости будет вычислено до запуска монитора службы. Если эвакуация прошла успешно, монитор будет запущен. В противном случае монитор не будет запущен, а состояние службы останется прежним. <P></DL><A NAME="lbAO">&nbsp;</A><H3> Определения периода </H3><P> Периоды используются для определения условий, которые должны позволять доставку оповещений. <P><DL COMPACT><DT> <B>period</b> <I>[label:] periodpec</i> <DD> Период группирует один или несколько сигналов тревоги и переменных, которые определяют частоту появления предупреждений в случае сбоя. Ключевое слово <B>period</b> имеет две формы. Первый принимает аргумент, который является спецификацией периода из модуля Perl 5 Патрика Райана Time :: Period. Обратитесь к &quot;perldoc Time :: Period&quot; для получения дополнительной информации. <P> Вторая форма требует метки с указанием периода, как определено выше. Метка представляет собой тег, состоящий из буквенного символа или подчеркивания, за которым следует ноль или более буквенно-цифровых или подчеркиваний и заканчивающийся двоеточием. Эта форма допускает несколько периодов с одинаковым определением периода. Одно из применений состоит в том, чтобы иметь определение периода, в котором отсутствуют параметры <B>alerttafter</b> или <B>alerttevery</b> для определенного периода времени, а другое - для того же периода времени с другим набором предупреждений, который содержит эти параметры. <P><DT> <B>оповещение</b> <I>каждый раз</i> <DD> <B>Ключевое</b> слово <B>alerttevery</b> (в пределах определения <B>периода</b> ) принимает тот же тип аргумента, что и переменная <B>интервала</b> , и ограничивает количество отправлений оповещения, когда служба продолжает сбой. Например, если интервал равен «1 ч», то только предупреждения в разделе периодов будут срабатывать только один раз в час. Если ключевое слово <B>alerttevery</b> отсутствует в записи периода, предупреждение будет отправляться каждый раз при обнаружении сбоя. По умолчанию, если выходные данные двух последовательных сбоев изменяются, то интервал оповещения переопределяется. Если слово «сводка» является последним аргументом, то при сравнении результатов последовательных сбоев будут учитываться только строки итоговых выходных данных. <P><DT> <B>alerttafter</b> <I>num</i> <DD><P><DT> <B>alerttafter</b> <I>num timeval</i> <DD> <B>Ключевое</b> слово <B>alerttafter</b> (в разделе <B>period</b> ) имеет две формы: только с аргументом «num» или с аргументами «num timeval». В первой форме предупреждение будет вызываться только после &quot;num&quot; последовательных сбоев. <P> Во второй форме аргументы представляют собой положительное целое число, за которым следует интервал, как описано в переменной <B>промежутка</b> выше. Если эти параметры указаны, то оповещения за этот период будут вызываться только после того, как в этом интервале произойдет много сбоев. Например, если параметру <B>alerttafter</b> даны аргументы «3 30 м», предупреждение будет <B>вызвано</b> , если в течение 30 минут произойдет 3 сбоя. <P><DT> <B>Numalerts</b> <I>Num</i> <DD><P> Эта переменная указывает серверу вызывать не более <I>num</i> оповещений во время сбоя. Счетчик предупреждений поддерживается для каждого периода и сбрасывается при каждом успехе. <P><DT> <B>comp_alerts</b> <DD><P> Если указана эта опция, то upalerts будет вызываться только в том случае, если было вызвано соответствующее предупреждение «down». <P><DT> <B>alert</b> <I>alert [arg ...]</i> <DD> Период может содержать несколько предупреждений, которые срабатывают при сбое службы. Оповещение указывается с ключевым словом <B>alert</b> , за которым следует необязательный параметр <B>выхода</b> и аргументы, которые интерпретируются так же, как определение <B>монитора</b> , но без &quot;;;&quot; исключение. Параметр <B>выхода</b> принимает форму <B>exit = x</b> или <B>exit = xy</b> и приводит к тому, что предупреждение вызывается только в том случае, если состояние выхода сценария монитора попадает в диапазон параметра <B>выхода</b> . Например, если строка <I>оповещения имеет вид: exit exit = 10-20 mail.alert mis,</i> тогда <I>mail-alert</i> будет вызываться только с аргументом <I>mis в</i> качестве аргументов, если значение выхода программы монитора находится в диапазоне от 10 до 20. Эта функция позволяет запускать различные предупреждения на разных уровнях серьезности (например, когда свободное место на диске увеличивается с 8% до 3%). <P> См. Выше раздел <B>ALERT PROGRAMS, где</b> приведен список правил, которые будут переданы в программы оповещения. <P><DT> <B>upalert</b> <I>alert [аргумент ...]</i> <DD> <B>Упалерт</b> - комплимент <B>предупреждения</b> . Упалерт вызывается, когда сервисы переходят из состояния отказа в успех. Сценарий <B>upalert</b> называется предоставлением тех же параметров, что и сценарий <B>оповещения</b> , с добавлением параметра <B>-u,</b> который просто используется, чтобы сообщить сценарию оповещения, что он вызывается как upalert. Для каждого определения периода может быть указано несколько upalerts. Обратите внимание, что стандартное поведение заключается в том, что upalert будет отправляться независимо от того, были ли ранее отправлены какие-либо предупреждения «down», так как upalerts запускаются при переходе состояния. Установите для каждого периода параметр <B>comp_alerts,</b> чтобы связать upalerts с предупреждениями &quot;down&quot;. <P><DT> <B>startupalert</b> <I>alert [arg ...]</i> <DD> <B>Startalert</b> вызывается только когда сервер <B>mon</b> начинает выполнение. <P><DT> <B>upalertafter</b> <I>timeval</i> <DD> Параметр <B>upalertafter</b> указывается в виде строки, которая соответствует синтаксису параметра <B>интервала</b> («30 с», «1 м» и т. Д.) И управляет <B>запуском upalert</b> . Если сервис возвращается после отключения в течение времени, превышающего или равного значению этой опции, <B>вызывается upalert</b> . Используйте эту опцию, чтобы предотвратить вызов upalerts из-за «всплесков» (кратковременных отключений). <P>