<header> MON服務定義幫助</header><p>這是MON配置的第二個也是最後一個階段。 <p>顯示強制性服務的默認值<marked in RED color> 。請參閱下面的相應幫助主題，以獲取有關服務定義的更多幫助。 <p>對於<b>“ mail.alert”</b> ，請確保已配置<b>sendmail</b>並在主機上啟動了<b>“ sendmail”</b>守護進程。 <H3>服務定義</H3><P><DL COMPACT><DT> <B>服務</b> <I>SERVICENAME</i> <DD>服務定義以關鍵字<B>service</b>開頭，後跟單詞即該服務的標籤。 <P>服務的組成部分包括時間間隔，監視器以及一個或多個時間段定義，如下所示。 <P>如果在名為“ dafault”的監視組中定義了“默認”服務名稱（請參見上文），則默認/默認定義將用於處理未知的mon陷阱。 <P><DT> <B>間隔</b> <I>的timeval</i> <DD>關鍵字<B>間隔</b>後跟一個時間值，指定觸發監視腳本的頻率。時間值定義為“ 30s”，“ 5m”，“ 1h”或“ 1d”，表示30秒，5分鐘，1小時或1天。數字部分可以是分數，例如“ 1.5h”或一個半小時。時間規範的這種格式將稱為<I>timeval</i> 。 <P><DT> <B>traptimeout</b> <I>的timeval</i> <DD>此關鍵字採用與<B>interval</b>相同的時間指定參數<I>，</i>並使服務至少經常期望來自外部源的陷阱，否則將記錄失敗。這用於心跳式服務。 <P><DT> <B>trapduration</b> <I>的timeval</i> <DD>如果收到陷阱，則陷阱被傳遞到的服務的狀態通常將保持不變。如果指定了<B>trapduration</b> ，則服務的狀態將在<I>timeval</i>指定的持續時間內保持失敗狀態，然後將其重置為“成功”。 <P><DT> <B>randskew</b> <I>timeval</i> <DD>而不是安排監視腳本在每個間隔開始時運行，而是通過正負<B>randskew</b>隨機調整<B>interval</b>參數指定的<B>間隔</b> <B>。</b>偏斜值指定為<B>interval</b>參數：“ 30s”，“ 5m”等。例如，如果<B>interval</b>為1m， <B>randskew</b>為“ 5s”，則<I>mon</i>將在每55秒和65秒目的是在以相同的時間間隔計劃許多服務時，幫助在服務器上分配負載。 <P><DT> <B>monitor</b> <I>monitor-name [arg ...]</i> <DD>關鍵字<B>Monitor</b>後跟腳本名稱和參數指定了計時器到期時要運行的監視器。指定要發送到監視腳本的參數時，遵循類似Shell的引用約定。該腳本是從<B>-s</b>參數給定的目錄中調用的，隨後的所有單詞均作為監視程序的參數提供，其後是當前監視組所引用的組中的主機列表。如果監視行以“ ;;”結尾作為一個單獨的詞，在調用程序時，主機組不會附加到參數列表中。 <P><DT> <B>allow_empty_group</b> <DD>即使由於監視的主機而導致該監視的主機組為空， <B>allow_empty_group</b>選項也將允許調用監視器。禁用主機組中的所有主機後，默認行為是不調用監視器。 <P><DT> <B>描述</b> <I>descriptiontext</i> <DD>客戶端程序查詢以下<B>描述</b>的文本，並通過環境變量將其傳遞給警報和監視器。它應包含該服務的簡短說明，適合包含在電子郵件或網頁中。 <P><DT> <B>exclude_hosts</b> <I>主機[主機...]</i> <DD>在<B>exclude_hosts</b>之後列出的所有主機將從服務檢查中排除。 <P><DT> <B>exclude_period</b> <I>periodspec</i> <DD>不要在<I>periodspec</i>標識的時間內運行計劃的監視器。 <P><DT> <B>依賴</b> <I>dependexpression</i> <DD> <B>Depend</b>關鍵字用於指定依賴項表達式，在布爾意義上，該表達式的值為true或false。依賴關係是Perl的實際表達式，必須遵守所有語法規則。表達式在其自己的程序包空間中求值，以免意外地產生一些不需要的副作用。如果在評估表達式時發現語法錯誤，則會通過syslog記錄該錯誤。 <P>在求值之前，對錶達式進行以下替換：看起來像“ group：service”的短語將替換為該指定服務的當前操作狀態的值。這些opstatus替換是遞歸計算的，因此，如果服務A依賴於服務B，並且服務B依賴於服務C，則服務A依賴於服務C。成功的操作狀態（評估為“ 1”）為“ STAT_OK”，“ STAT_COLDSTART” ”，“ STAT_WARMSTART”和“ STAT_UNKNOWN”。單詞“ SELF”（大寫）可用於該組（例如“ SELF：service”），是當前監視組的縮寫。 <P>此功能可用於控制依賴於其他服務的服務的警報，例如，依賴於可ping通的計算機的SMTP測試。 <P><DT> <B>dep_behavior</b> <I>{a | m}</i> <DD>依賴圖的評估可以控制警報或監視調用的抑制。 <P> <B>警報抑制</b> 。如果將此選項設置為“ a”，則在退出服務的監視器或接收到陷阱之後，將對依賴項表達式求值。僅在評估成功時才發送警報，這意味著依賴關係圖中的任何節點均未指示失敗。 <P> <B>監視抑制</b> 。如果將其設置為“ m”，則將在將要運行該服務的監視器之前撤消依賴項表達式。如果評估成功，則將運行監視器。否則，監視器將不會運行，並且服務狀態將保持不變。 <P></DL><A NAME="lbAO">&nbsp;</A><H3>期間定義</H3><P>使用句點來定義應該允許發送警報的條件。 <P><DL COMPACT><DT> <B>期間</b> <I>[標籤：] periodspec</i> <DD>句點將一個或多個警報和變量分組，這些變量和變量控制發生故障時警報發生的頻率。 <B>period</b>關鍵字有兩種形式。第一個參數是Patrick Ryan的Time :: Period Perl 5模塊中的周期規範。有關更多信息，請參見“ perldoc Time :: Period”。 <P>第二種形式需要一個標籤，後跟一個週期說明，如上所述。該標籤是由字母字符或下劃線後跟零個或多個字母數字或下劃線並以冒號結尾的標籤。此格式允許具有相同期間定義的多個期間。一種用途是具有一個期間定義，該定義在特定時間段內不具有<B>alertafter</b>或<B>everyevery</b>參數，而在同一時間段內，另一個定義<B>包含一組</b>不包含那些參數的警報。 <P><DT> <B>alertevery的</b> <I>的timeval</i> <DD> <B>alertevery</b>關鍵字（在<B>周期</b>定義內）採用與<B>interval</b>變量相同的參數類型，並限制服務繼續失敗時發送警報的次數。例如，如果間隔為“ 1h”，則僅時段部分中的警報僅每小時觸發一次。如果在期間條目中省略<B>alertevery</b>關鍵字，則每次檢測到故障時都會發出警報。默認情況下，如果兩個連續故障的輸出發生變化，則警報間隔將被覆蓋。如果單詞“ summary”是最後一個參數，則在比較連續失敗的輸出時，僅考慮摘要輸出行。 <P><DT> <I>num之後的</i> <B>警報</b> <DD><P><DT> <I>num timeval之後</i> <B>發出警報</b> <DD> <B>alertafter</b>關鍵字（在<B>句點</b>部分）具有兩種形式：僅帶有“ num”參數，或者帶有“ num timeval”參數。在第一種形式中，僅在“ num”個連續失敗之後才調用警報。 <P>在第二種形式中，自變量是一個正整數，後跟一個間隔，如上面的<B>interval</b>變量所述。如果指定了這些參數，則僅在該時間間隔內發生許多故障之後才調用該時間段的警報。例如，如果將<B>alertafter</b>的參數設置為“ 3 30m”，則如果在30分鐘內發生3次故障，則將調用警報。 <P><DT> <B>numalerts</b> <I>num</i> <DD><P>此變量告訴服務器在故障期間最多調用<I>num個</i>警報。警報計數器會定期保存，並在每次成功後重置。 <P><DT> <B>comp_alerts</b> <DD><P>如果指定了此選項，則僅在調用了相應的“關閉”警報時才調用upalerts。 <P><DT> <B>警報</b> <I>警報[arg ...]</i> <DD>一個期間可能包含多個警報，這些警報在服務失敗時觸發。用<B>alert</b>關鍵字指定一個警報，後跟一個可選的<B>退出</b>參數，以及與<B>監視器</b>定義解釋相同的參數，但不帶“ ;;”。例外。 <B>exit</b>參數採用<B>exit = x</b>或<B>exit = xy</b>的形式，其作用是僅在監視腳本的退出狀態落在<B>exit</b>參數範圍內時才調用警報。例如，如果警報行是<I>alert exit = 10-20 mail.alert mis，</i>則僅當監視程序的退出值在10到20之間時，才使用<I>mis</i>作為參數來調用<I>mail-alert。</i>此功能允許您觸發不同嚴重性級別的警報（例如可用磁盤空間從8％變為3％時）。 <P>請參閱上面的<B>ALERT PROGRAMS（警報程序）</b>部分，以獲取將自動傳遞到警報程序的pramaeters列表。 <P><DT> <B>upalert</b> <I>警報[arg ...]</i> <DD> <B>警報</b>是對<B>警報</b>的稱讚。當服務使狀態從失敗轉變為成功時，將調用upalert。 <B>upalert</b>腳本稱為提供與<B>警報</b>腳本相同的參數，並附加了<B>-u</b>參數，該參數僅用於使警報腳本知道其被稱為upalert。可以為每個期間定義指定多個upalerts。請注意，默認行為是，無論之前是否發送過任何“關閉”警報，都將發送upalert，因為upalert在狀態轉換時觸發。設置每個週期的<B>comp_alerts</b>選項，以將upalerts與“ down”警報配對。 <P><DT> <B>startupalert</b> <I>警報[arg ...]</i> <DD>僅在<B>mon</b>服務器開始執行時才調用<B>startupalert</b> 。 <P><DT> <B>upalertafter</b> <I>的timeval</i> <DD> <B>upalertafter</b>參數被指定為遵循<B>interval</b>參數的語法的字符串（“ 30s”，“ 1m”等），並控制<B>upalert</b>的觸發。如果服務在關閉時間大於或等於此選項的值後<B>重新啟動，</b>則將調用<B>upalert</b> 。使用此選項可以防止由於“故障”（簡短中斷）而導致向上警報被調用。 <P>